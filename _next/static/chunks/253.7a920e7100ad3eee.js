"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{8253:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var n,a,l=r(7437),i=r(2265),c=r(7776),o=r(8938),u=r(9733),s=r(1648);let d=(e,t,r)=>{let n=e.distanceTo(t),a=new c.fHI(.5,.5,n,32),l=new c.vBJ({color:r}),i=new c.Kj0(a,l),o=new c.Pa4().addVectors(e,t).multiplyScalar(.5);i.position.copy(o);let u=new c.Pa4().subVectors(t,e).normalize(),s=new c.Pa4(0,1,0).cross(u).normalize(),d=Math.acos(new c.Pa4(0,1,0).dot(u));return i.quaternion.setFromAxisAngle(s,d),i},h=(e,t)=>{let r=t.geometry,n=new c.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.heightmap.length-e.townSquare.y]*s.Vl),a=new c.Pa4(e.docks.x-r.parameters.width/2,e.heightmap.length-e.docks.y-r.parameters.height/2,e.heightmap[e.docks.x][e.heightmap.length-e.docks.y]*s.Vl),l=new c.Pa4(e.temple.x-r.parameters.width/2,e.heightmap.length-e.temple.y-r.parameters.height/2,e.heightmap[e.temple.x][e.heightmap.length-e.temple.y]*s.Vl),i=new c.Pa4(n.x,n.y,n.z+10),o=new c.Pa4(a.x,a.y,a.z+10),u=new c.Pa4(l.x,l.y,l.z+10);return[d(n,i,16711935),d(a,o,65535),d(l,u,16776960)]},w=(e,t,r)=>{let n=t.geometry,a=new c.Pa4(e.temple.x-n.parameters.width/2,e.heightmap.length-e.temple.y-n.parameters.height/2,e.heightmap[e.temple.x][e.temple.y]*s.Vl),l=new c.Wid({color:16773358,roughness:.5,metalness:.1}),i=new c.fHI(15/r,13/r,2/r,32),o=new c.Kj0(i,l);o.position.set(a.x,a.y,a.z),o.rotation.x=-Math.PI/2;let u=new c.fHI(.5/r,.5/r,10/r,32),d=12/r,h=[];for(let e=0;e<12;e++){let t=e/12*2*Math.PI,n=d*Math.cos(t)+a.x,i=d*Math.sin(t)+a.y,o=new c.Kj0(u,l);o.position.set(n,i,a.z+5/r),o.rotation.x=-Math.PI/2,h=h.concat(o)}return[o,h]},m=(e,t)=>{let r=t.geometry,n=new c.Wid({color:16773358,roughness:.5,metalness:.1}),a=new c.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.townSquare.y]*s.Vl),l=new c.DvJ(1.2,1.2,.1),i=new c.Kj0(l,n);return i.position.set(a.x,a.y,a.z),i},p=e=>{let t=e.heightmap.length,r=new c._12(t,t,t-1,t-1),n=[];for(let a=0;a<r.attributes.position.array.length;a+=3){let l;let i=Math.floor(a/3%t),o=Math.floor(a/3/t);r.attributes.position.setZ(a/3,10*e.heightmap[i][o]),l=e.heightmap[i][o]<.001?new c.Ilk(255):new c.Ilk(8*e.heightmap[i][o],50+8*e.heightmap[i][o],8*e.heightmap[i][o]),i===e.townSquare.x&&o===e.townSquare.y&&(l=new c.Ilk(16711935)),n.push(l.r,l.g,l.b)}r.setAttribute("color",new c.a$l(n,3)),r.computeVertexNormals();let a=new c.YBo({vertexColors:!0,flatShading:!0});return new c.Kj0(r,a)};(n=a||(a={}))[n.FreeFloat=0]="FreeFloat",n[n.FreeFall=1]="FreeFall",n[n.Walking=2]="Walking";var g=e=>{let t=(0,i.useRef)(null),r=(0,i.useRef)(null);document.getElementById("fullscreen-btn");let[n,a]=(0,i.useState)(!1),s=(0,i.useRef)(null),d=(0,i.useRef)(null),g=(0,i.useRef)(null),f=(0,i.useRef)(null),x=(0,i.useRef)(null),y=(0,i.useRef)(null),v=(0,i.useRef)(null),b=(0,i.useRef)(null);(0,i.useRef)(null);let S=(0,i.useRef)(0),j=()=>{y.current.fov=75,y.current.aspect=1.5,y.current.near=.1,y.current.far=1e3,y.current.position.set(0,0,100)},k=(0,i.useRef)(0);return(0,i.useEffect)(()=>{let e=new c.CP7({antialias:!0});e.setSize(Math.min(window.innerWidth-100,600),400),r.current=e,t.current.appendChild(r.current.domElement);let n=new c.xsS,a=new c.Mig(4210752);n.add(a),d.current=a;let l=new c.Ox3(16777215,1);l.position.set(50,50,50),n.add(l),g.current=l,s.current=n;let i=new c.cPb(75,1.5,.1,1e3);i.position.set(0,0,100),y.current=i;let u=new o.z(i,r.current.domElement);u.enableDamping=!0,u.dampingFactor=.05,b.current=u;let h=e=>{if(y.current&&v.current){if(v.current instanceof o.z)switch(e.key){case"w":let t=new c.Pa4(0,1,0);v.current.target.addScaledVector(t,10),y.current.position.addScaledVector(t,10);break;case"s":let r=new c.Pa4(0,-1,0);v.current.target.addScaledVector(r,10),y.current.position.addScaledVector(r,10);break;case"a":let n=new c.Pa4(-1,0,0);v.current.target.addScaledVector(n,10),y.current.position.addScaledVector(n,10);break;case"d":let a=new c.Pa4(1,0,0);v.current.target.addScaledVector(a,10),y.current.position.addScaledVector(a,10)}b.current.update()}};return window.addEventListener("keydown",h),v.current=u,S.current=0,()=>{var n;window.removeEventListener("keydown",h),null===(n=t.current)||void 0===n||n.removeChild(e.domElement),r.current.dispose()}},[]),(0,i.useEffect)(()=>{let n;if(s.current)for(;s.current.children.length>0;)s.current.remove(s.current.children[0]);if(S.current=0,j(),b.current.enabled=!0,!t.current||!e.world||!r.current)return;if(f.current=new c.SUY,e.world.heightmap&&s.current){let t=p(e.world);x.current=t,s.current.add(t);{let[r,n,a]=h(e.world,t);s.current.add(r),s.current.add(n),s.current.add(a)}let[r,n]=w(e.world,t,12);s.current.add(r),n.forEach(e=>{s.current.add(e)});let a=m(e.world,t);s.current.add(a),d.current&&s.current.add(d.current),g.current&&s.current.add(g.current)}let a=()=>{n=requestAnimationFrame(a);let e=f.current.getDelta();if(1===S.current){k.current+=9.81*e,y.current.position.z-=k.current*e;let t=new c.Pa4(0,0,-1),r=new c.iMs;r.set(y.current.position,t);let n=r.intersectObject(x.current);n.length>0&&n[0].distance<=k.current*e&&(y.current.position.z=5,y.current.lookAt(new c.Pa4(1,0,0)),S.current=2,k.current=0)}else b.current.update();r.current.render(s.current,y.current)};return a(),()=>cancelAnimationFrame(n)},[e.world]),(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)("div",{className:"flex h-full justify-center",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{id:"container",className:"relative",children:(0,l.jsx)(u.z,{id:"fullscreen-btn",onClick:()=>{let t=!n;t?r.current.setSize(window.innerWidth-100,window.innerHeight-100):r.current.setSize(600,400),a(t),e.handleFullscreenChange(t)},className:"absolute top-1 right-2 z-10 px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",children:"『』"})}),(0,l.jsx)("div",{ref:t}),(0,l.jsx)("div",{id:"container",className:"relative",children:(0,l.jsxs)("div",{className:"flex p-4",children:[(0,l.jsx)("div",{className:"flex w-1/3",children:(0,l.jsx)(u.z,{onClick:()=>{y.current&&v.current&&(j(),S.current=0,y.current.updateProjectionMatrix(),b.current.reset(),b.current.enabled=!0,v.current=b.current)},children:"Reset View"})}),(0,l.jsx)("div",{className:"flex w-1/3 justify-center",children:(0,l.jsx)(u.z,{onClick:()=>{if(!y.current||!v.current||!e.world||!x.current)return;let t=new c.Pa4(e.world.townSquare.x-x.current.geometry.parameters.width/2,e.world.heightmap.length-e.world.townSquare.y-x.current.geometry.parameters.height/2,10);y.current.position.set(t.x,t.y,50),b.current.target.copy(t),b.current.update()},children:"Go to Town Center"})}),(0,l.jsx)("div",{className:"flex w-1/3 justify-end",children:(0,l.jsx)(u.z,{onClick:()=>{b.current.enabled=!1,S.current=1,console.log("Free fall")},children:"Free Fall"})})]})})]})})})}},9733:function(e,t,r){r.d(t,{z:function(){return u}});var n=r(7437),a=r(2265),l=r(1538),i=r(2218),c=r(9354);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,asChild:u=!1,...s}=e,d=u?l.g7:"button";return(0,n.jsx)(d,{className:(0,c.cn)(o({variant:a,size:i,className:r})),ref:t,...s})});u.displayName="Button"},1648:function(e,t,r){r.d(t,{Br:function(){return n},Vl:function(){return l},ip:function(){return a}});let n=5,a=10,l=10},9354:function(e,t,r){r.d(t,{cn:function(){return l}});var n=r(4839),a=r(6164);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}}}]);