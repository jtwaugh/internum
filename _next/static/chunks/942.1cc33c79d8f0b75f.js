"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{4942:function(e,t,l){l.r(t),l.d(t,{default:function(){return Y}});var s=l(7437),a=l(2265);class r{isEmpty(){return 0===this.elements.length}put(e,t){this.elements.push({item:e,priority:t}),this.elements.sort((e,t)=>e.priority-t.priority)}get(){var e;return null===(e=this.elements.shift())||void 0===e?void 0:e.item}constructor(){this.elements=[]}}function n(e,t){let l=[],{x:s,y:a}=e;for(let e of[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0},{x:1,y:1},{x:1,y:-1},{x:-1,y:1},{x:-1,y:-1}]){let r=s+e.x,n=a+e.y;r>=0&&n>=0&&r<t[0].length&&n<t.length&&l.push({x:r,y:n})}return l}function o(e,t,l){return i(e,t)+Math.abs(l[t.y][t.x]-l[e.y][e.x])}function i(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function c(e,t){return e.x===t.x&&e.y===t.y}function d(e){return"".concat(e.x,",").concat(e.y)}function u(e,t,l){let s=l,a=[];for(;s&&!c(s,t);)a.push(s),s=e.get(d(s))||null;a.push(t);let r=a.reverse();return console.log(r),r}var f=l(1648);let x=()=>{let[e,t]=(0,a.useState)(0),l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=()=>{l.current&&t(l.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),[l,e]};var h=l(5068),m=l(9354);let p=a.forwardRef((e,t)=>{let{className:l,...a}=e;return(0,s.jsxs)(h.fC,{ref:t,className:(0,m.cn)("relative flex w-full touch-none select-none items-center",l),...a,children:[(0,s.jsx)(h.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,s.jsx)(h.e6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(h.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});p.displayName=h.fC.displayName;var g=l(9733),v=l(2447);let b=v.fC,j=a.forwardRef((e,t)=>{let{className:l,...a}=e;return(0,s.jsx)(v.aV,{ref:t,className:(0,m.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",l),...a})});j.displayName=v.aV.displayName;let y=a.forwardRef((e,t)=>{let{className:l,...a}=e;return(0,s.jsx)(v.xz,{ref:t,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",l),...a})});y.displayName=v.xz.displayName;let N=a.forwardRef((e,t)=>{let{className:l,...a}=e;return(0,s.jsx)(v.VY,{ref:t,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l),...a})});N.displayName=v.VY.displayName;var w=l(4756),C=l(4867);let S=w.fC,k=a.forwardRef((e,t)=>{let{className:l,...a}=e;return(0,s.jsx)(w.ck,{ref:t,className:(0,m.cn)("border-b",l),...a})});k.displayName="AccordionItem";let z=a.forwardRef((e,t)=>{let{className:l,children:a,...r}=e;return(0,s.jsx)(w.h4,{className:"flex",children:(0,s.jsxs)(w.xz,{ref:t,className:(0,m.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",l),...r,children:[a,(0,s.jsx)(C.v4q,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})});z.displayName=w.xz.displayName;let R=a.forwardRef((e,t)=>{let{className:l,children:a,...r}=e;return(0,s.jsx)(w.VY,{ref:t,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:(0,s.jsx)("div",{className:(0,m.cn)("pb-4 pt-0",l),children:a})})});R.displayName=w.VY.displayName;let V=a.forwardRef((e,t)=>{let{className:l,type:a,...r}=e;return(0,s.jsx)("input",{type:a,className:(0,m.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",l),ref:t,...r})});V.displayName="Input";var D=l(402);let E=e=>{let[t,l]=(0,a.useState)(e.value);return(0,s.jsxs)("div",{className:"mb-4 flex space-x-2",children:[(0,s.jsx)("div",{className:"flex items-center justify-start w-1/2",children:(0,s.jsx)(D._,{className:"items-center text-xs font-semibold",children:e.text})}),(0,s.jsx)("div",{className:"flex items-center justify-end w-1/2",children:(0,s.jsx)("div",{className:"flex items-center space-x-4 resize-none",children:(0,s.jsx)(V,{className:"border leading-tight text-xs",value:t,onChange:t=>{let s=t.target.value.toLowerCase();l(s=s.startsWith("#")?"#"+s.slice(1).replace(/[^0-9a-f]/gi,""):"#"+s.replace(/[^0-9a-f]/gi,"")),/^#[0-9a-f]{6}$/i.test(s)&&e.onChange(s)},placeholder:e.placeholder})})}),(0,s.jsx)("div",{className:"w-[10px] rounded-full border",style:{backgroundColor:t}})]})};var I=e=>{let[t,l]=(0,a.useState)(e.currentGradient[0]),[r,n]=(0,a.useState)(e.currentGradient[1]),[o,i]=(0,a.useState)(e.currentGradient[2]),[c,d]=(0,a.useState)(e.currentGradient[3]);return(0,a.useEffect)(()=>{e.onChange([t,r,o,c])},[t,r,o,c]),(0,s.jsxs)("div",{children:[(0,s.jsx)(E,{text:"Highlands",value:c,placeholder:f.ob[3],onChange:d}),(0,s.jsx)(E,{text:"Midlands",value:o,placeholder:f.ob[2],onChange:i}),(0,s.jsx)(E,{text:"Lowlands",value:r,placeholder:f.ob[1],onChange:n}),(0,s.jsx)(E,{text:"Water",value:t,placeholder:f.ob[0],onChange:l})]})},L=l(7020),M=l.n(L);let A=(e,t)=>{let l=[],s=t.canvasSize/2,a=t.canvasSize/2,r=e.dist(0,0,s,a)*t.maxDistanceFactor;for(let n=0;n<t.canvasSize;n++){l[n]=[];for(let o=0;o<t.canvasSize;o++){let i=e.noise(n*t.noiseScale,o*t.noiseScale)-e.dist(n,o,s,a)/r;i=e.constrain(i,0,1),l[n][o]=i,i>1e-4&&i<t.threshold&&(l[n][o]=0)}}return l},F=(e,t)=>{let l=e,s=e;for(let e=0;e<t.blurIterations;e++){s=l.map(e=>[...e]);for(let e=1;e<t.canvasSize-1;e++)for(let a=1;a<t.canvasSize-1;a++)s[e][a]=(3*l[e][a]+l[e-1][a]+l[e+1][a]+l[e][a-1]+l[e][a+1]+l[e-1][a-1]+l[e-1][a+1]+l[e+1][a-1]+l[e+1][a+1])/11;l=s}return s},G=(e,t,l,s)=>{let a=e.length;for(let t=0;t<a;t++)for(let r=0;r<a;r++)if(l[t][r]>0){let a=5e-4*s.erosionRate*l[t][r];e[t][r]=e[t][r]-a}return e},K=(e,t)=>{let l=t.canvasSize,s=Array(l).fill(null).map(()=>Array(l).fill(!1)),a=[{x:l-1,y:0}];for(;a.length>0;){let{x:t,y:r}=a.shift();if(!s[t][r]&&!(e[t][r]>.001))for(let e of(s[t][r]=!0,[{x:t-1,y:r},{x:t+1,y:r},{x:t,y:r-1},{x:t,y:r+1}]))e.x>=0&&e.x<l&&e.y>=0&&e.y<l&&a.push(e)}return s},W=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,B=(e,t)=>{let l=e.length,s=[];for(let a=0;a<l;a++)for(let r=0;r<l;r++)e[a][r]>t.threshold&&s.push({x:a,y:r});if(0===s.length)throw Error("No land tiles available to place the town square.");let a=W(0,s.length-1);return s[a]},_=(e,t,l,s)=>{let a=e.length,r=t,n=0;for(let o=-s;o<=s;o++)if(!(o>-l)||!(o<l))for(let i=-s;i<=s;i++){if(i>-l&&i<l)continue;let s=t.x+o,c=t.y+i;s>=0&&c>=0&&s<a&&c<a&&e[s][c]>n&&(n=e[s][c],r={x:s,y:c})}return r},q=e=>F(A(new(M())(e=>{}),e),e),P=(e,t)=>{let l=e.length,s=e[0].length,a=Array.from({length:l},()=>Array(s).fill(null));for(let r=0;r<l;r++)for(let n=0;n<s;n++){if(e[r][n]<t.threshold)continue;let o=-1/0,i=null;for(let a=0;a<f.nK.length;a++){let[c,d]=f.nK[a],u=r+c,x=n+d;if(u>=0&&u<l&&x>=0&&x<s){let l=e[u][x]<t.threshold?1:e[r][n]-e[u][x];l>o&&(o=l,i=a)}}if(null!==i){let[t,l]=f.nK[i];e[r+t][n+l],e[r][n],o<1e-6?a[r][n]=null:a[r][n]=i}e[r][n]>1e-4&&a[r][n]}return a},T=(e,t)=>{let l=e.length,s=e[0].length,a=Array.from({length:l},()=>Array(s).fill(0));for(let r=0;r<l;r++)for(let n=0;n<s;n++){if(null===e[r][n])continue;let o=r,i=n;for(;;){let r=e[o][i];if(null===r)break;let[n,c]=f.nK[r],d=o+n,u=i+c;if(d<0||d>=l||u<0||u>=s)break;t[d][u]>t[o][i]&&console.error("BIG ERROR"),a[d][u]+=1,o=d,i=u}}return a};var Y=e=>{let[t,l]=(0,a.useState)(e.params.noiseScale),[h,m]=(0,a.useState)(e.params.canvasSize),[v,w]=(0,a.useState)(e.params.threshold),[C,V]=(0,a.useState)(e.params.waterLevel),[D,L]=(0,a.useState)(e.params.maxDistanceFactor),[M,A]=(0,a.useState)(e.params.blurIterations),[F,W]=(0,a.useState)(e.params.erosionRate),[Y,H]=(0,a.useState)(e.params.erosionIterations),[O,Q]=(0,a.useState)(f.ob),[U,$]=(0,a.useState)(f.KT),[J,X]=(0,a.useState)(f.VB),[Z,ee]=(0,a.useState)(f.bp),[et,el]=x(),[es,ea]=x();return((0,a.useEffect)(()=>{e.onColorsChanged({terrainGradient:O,ambientLight:U,directionalLight:J,waterColor:Z})},[O,U,J,Z]),(0,a.useEffect)(()=>{e.onParamsChanged({noiseScale:t,canvasSize:h,threshold:v,waterLevel:C,maxDistanceFactor:D,blurIterations:M,erosionRate:F,erosionIterations:Y})},[t,h,v,D,M,F]),(0,a.useEffect)(()=>{l(e.params.noiseScale),m(e.params.canvasSize),w(e.params.threshold),L(e.params.maxDistanceFactor),A(e.params.blurIterations)},[e.params]),e.display)?(0,s.jsx)("div",{id:"island-generator-container",className:"h-full",tabIndex:1,children:(0,s.jsxs)("div",{className:"border h-full flex flex-col",children:[(0,s.jsx)("div",{className:"w-full p-2",children:(0,s.jsx)(g.z,{className:"w-full pt-6 pb-6 border",style:{backgroundColor:"#0000aa"},onClick:()=>{let l={noiseScale:t,canvasSize:h,threshold:v,waterLevel:C,maxDistanceFactor:D,blurIterations:M,erosionRate:F,erosionIterations:Y},s=q(l),a=K(s,l),x=s,m=P(x,l),p=T(m,x),g=G(x,m,p,l);if(l.erosionIterations>1)for(let e=0;e<l.erosionIterations;e++)p=T(m=P(x=g,l),x),g=G(x,m,p,l);let b=B(g,l),j=null,y=null,N=null;for(let e=0;e<5&&(N=_(g,b,f.Br,f.ip),null===(j=function(e,t,l,s){let a=new r;a.put(e,0);let f=new Map,x=new Map,h=d(e);for(d(t),f.set(h,null),x.set(h,0);!a.isEmpty();){let s=a.get();if(c(s,t))return u(f,e,t);for(let e of n(s,l)){let r=i(s,e);if(Math.abs(Math.abs((l[e.y][e.x]-l[s.y][s.x])/r))>999)continue;l[e.y][e.x];let n=(x.get(d(s))||0)+o(s,e,l),c=d(e);if(!x.has(c)||n<(x.get(c)||1/0)){x.set(c,n);let l=n+i(e,t);a.put(e,l),f.set(c,s)}}}return null}(b,N,g,0)));e+=1);j&&(console.log("path to temple: ",j),console.log("temple coords: ",j[(null==j?void 0:j.length)-1]));for(let e=0;e<5&&null===(y=function(e,t,l,s){let a=new r;a.put(e,0);let c=new Map,f=new Map,x=d(e);for(c.set(x,null),f.set(x,0);!a.isEmpty();){let s=a.get();if(l[s.x][s.y]<1e-4)return u(c,e,s);for(let e of n(s,l)){i(s,e),l[e.y][e.x],l[s.y][s.x];let r=(f.get(d(s))||0)+o(s,e,l),n=d(e);if(!f.has(n)||r<(f.get(n)||1/0)){f.set(n,r);let l=r+function(e,t){let l=1/0;for(let s=0;s<t.length;s++)for(let a=0;a<t[0].length;a++)if(t[s][a]){let t=i(e,{x:a,y:s});t<l&&(l=t)}return l}(e,t);a.put(e,l),c.set(n,s)}}}return null}(b,a,g,0));e+=1);y&&(console.log("path to docks: ",y),console.log("docks coords: ",y[(null==y?void 0:y.length)-1])),e.onWorldGenerated({heightmap:g,waterLevel:l.waterLevel,oceanTiles:a,flowDirections:m,waterAccumulation:p,townSquare:b,temple:N,docks:y?y[(null==y?void 0:y.length)-1]:null,templePath:j,docksPath:y})},children:(0,s.jsx)("div",{className:" text-2xl font-extrabold",children:"Generate"})})}),(0,s.jsxs)(b,{defaultValue:"worldgen",className:"flex-1 flex flex-col p-2",children:[(0,s.jsxs)(j,{className:"grid w-full grid-cols-2",children:[(0,s.jsx)(y,{ref:et,value:"worldgen",children:el>100?"\uD83C\uDF10 Parameters":"\uD83C\uDF10"}),(0,s.jsx)(y,{ref:es,value:"colors",children:ea>100?"\uD83C\uDFA8 Colors":"\uD83C\uDFA8"})]}),(0,s.jsxs)(N,{value:"worldgen",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Noise Scale: ",t]}),(0,s.jsx)(p,{className:"p-2",min:.01,max:.3,step:.01,value:[t],onValueChange:e=>l(e[0])})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Canvas Size: ",h]}),(0,s.jsx)(p,{className:"p-2",min:0,max:800,step:25,value:[h],onValueChange:e=>m(e[0])})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Max Distance Factor: ",D]}),(0,s.jsx)(p,{className:"p-2",min:.5,max:2,step:.1,value:[D],onValueChange:e=>L(e[0])})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Threshold: ",v]}),(0,s.jsx)(p,{className:"p-2",min:0,max:1,step:.05,value:[v],onValueChange:e=>w(e[0])})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Water level: ",C]}),(0,s.jsx)(p,{className:"p-2",min:0,max:1,step:.05,value:[C],onValueChange:e=>V(e[0])})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Blur Iterations: ",M]}),(0,s.jsx)(p,{className:"p-2",min:0,max:10,step:1,value:[M],onValueChange:e=>{A(e[0])}})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Erosion Rate: ",F]}),(0,s.jsx)(p,{className:"p-2",min:0,max:1,step:.01,value:[F],onValueChange:e=>{W(e[0])}})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{children:[(0,s.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Erosion Iterations: ",Y]}),(0,s.jsx)(p,{className:"p-2",min:1,max:10,step:1,value:[Y],onValueChange:e=>{H(e[0])}})]})})]}),(0,s.jsxs)(N,{value:"colors",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,s.jsx)(E,{text:"Ambient Light",value:U,placeholder:f.KT,onChange:$}),(0,s.jsx)(E,{text:"Directional Light",value:J,placeholder:f.VB,onChange:X}),(0,s.jsx)(E,{text:"Water Color",value:Z,placeholder:f.bp,onChange:ee}),(0,s.jsx)(S,{type:"single",collapsible:!0,className:"w-full",children:(0,s.jsxs)(k,{value:"item-1",children:[(0,s.jsxs)(z,{className:"flex",children:[(0,s.jsx)("div",{className:"w-1/2 text-start",children:"Gradient"}),(0,s.jsx)("div",{className:"w-1/2 border h-full rounded-md mr-2 ml-4",style:{background:"linear-gradient(180deg, ".concat(O[3],", ").concat(O[2],", ").concat(O[1],", ").concat(O[0],")")}})]}),(0,s.jsx)(R,{children:(0,s.jsx)(I,{currentGradient:O,onChange:e=>{Q(e)}})})]})})]})]})]})}):(0,s.jsx)(s.Fragment,{})}}}]);