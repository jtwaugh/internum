"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{4942:function(e,t,l){l.r(t),l.d(t,{default:function(){return Y}});var a=l(7437),s=l(2265);class n{isEmpty(){return 0===this.elements.length}put(e,t){this.elements.push({item:e,priority:t}),this.elements.sort((e,t)=>e.priority-t.priority)}get(){var e;return null===(e=this.elements.shift())||void 0===e?void 0:e.item}constructor(){this.elements=[]}}function r(e,t){let l=[],{x:a,y:s}=e;for(let e of[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0},{x:1,y:1},{x:1,y:-1},{x:-1,y:1},{x:-1,y:-1}]){let n=a+e.x,r=s+e.y;n>=0&&r>=0&&n<t[0].length&&r<t.length&&l.push({x:n,y:r})}return l}function i(e,t,l){return o(e,t)+Math.abs(l[t.y][t.x]-l[e.y][e.x])}function o(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function c(e,t){return e.x===t.x&&e.y===t.y}function d(e){return"".concat(e.x,",").concat(e.y)}function u(e,t,l){let a=l,s=[];for(;a&&!c(a,t);)s.push(a),a=e.get(d(a))||null;s.push(t);let n=s.reverse();return console.log(n),n}var f=l(1648);let x=()=>{let[e,t]=(0,s.useState)(0),l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=()=>{l.current&&t(l.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),[l,e]};var h=l(5068),m=l(9354);let p=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsxs)(h.fC,{ref:t,className:(0,m.cn)("relative flex w-full touch-none select-none items-center",l),...s,children:[(0,a.jsx)(h.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,a.jsx)(h.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(h.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});p.displayName=h.fC.displayName;var g=l(9733),v=l(2447);let b=v.fC,j=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(v.aV,{ref:t,className:(0,m.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",l),...s})});j.displayName=v.aV.displayName;let y=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(v.xz,{ref:t,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",l),...s})});y.displayName=v.xz.displayName;let N=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(v.VY,{ref:t,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l),...s})});N.displayName=v.VY.displayName;var w=l(4756),C=l(4867);let S=w.fC,z=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(w.ck,{ref:t,className:(0,m.cn)("border-b",l),...s})});z.displayName="AccordionItem";let k=s.forwardRef((e,t)=>{let{className:l,children:s,...n}=e;return(0,a.jsx)(w.h4,{className:"flex",children:(0,a.jsxs)(w.xz,{ref:t,className:(0,m.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",l),...n,children:[s,(0,a.jsx)(C.v4q,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})});k.displayName=w.xz.displayName;let R=s.forwardRef((e,t)=>{let{className:l,children:s,...n}=e;return(0,a.jsx)(w.VY,{ref:t,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,a.jsx)("div",{className:(0,m.cn)("pb-4 pt-0",l),children:s})})});R.displayName=w.VY.displayName;let D=s.forwardRef((e,t)=>{let{className:l,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,m.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",l),ref:t,...n})});D.displayName="Input";var E=l(402);let I=e=>{let[t,l]=(0,s.useState)(e.value);return(0,a.jsxs)("div",{className:"mb-4 flex space-x-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-start w-1/2",children:(0,a.jsx)(E._,{className:"items-center text-xs font-semibold",children:e.text})}),(0,a.jsx)("div",{className:"flex items-center justify-end w-1/2",children:(0,a.jsx)("div",{className:"flex items-center space-x-4 resize-none",children:(0,a.jsx)(D,{className:"border leading-tight text-xs",value:t,onChange:t=>{let a=t.target.value.toLowerCase();l(a=a.startsWith("#")?"#"+a.slice(1).replace(/[^0-9a-f]/gi,""):"#"+a.replace(/[^0-9a-f]/gi,"")),/^#[0-9a-f]{6}$/i.test(a)&&e.onChange(a)},placeholder:e.placeholder})})}),(0,a.jsx)("div",{className:"w-[10px] rounded-full border",style:{backgroundColor:t}})]})};var V=e=>{let[t,l]=(0,s.useState)(e.currentGradient[0]),[n,r]=(0,s.useState)(e.currentGradient[1]),[i,o]=(0,s.useState)(e.currentGradient[2]),[c,d]=(0,s.useState)(e.currentGradient[3]);return(0,s.useEffect)(()=>{e.onChange([t,n,i,c])},[t,n,i,c]),(0,a.jsxs)("div",{children:[(0,a.jsx)(I,{text:"Highlands",value:c,placeholder:f.ob[3],onChange:d}),(0,a.jsx)(I,{text:"Midlands",value:i,placeholder:f.ob[2],onChange:o}),(0,a.jsx)(I,{text:"Lowlands",value:n,placeholder:f.ob[1],onChange:r}),(0,a.jsx)(I,{text:"Water",value:t,placeholder:f.ob[0],onChange:l})]})},M=l(7020),A=l.n(M);let F=(e,t)=>{let l=[],a=t.canvasSize/2,s=t.canvasSize/2,n=e.dist(0,0,a,s)*t.maxDistanceFactor;for(let r=0;r<t.canvasSize;r++){l[r]=[];for(let i=0;i<t.canvasSize;i++){let o=e.noise(r*t.noiseScale,i*t.noiseScale)-e.dist(r,i,a,s)/n;o=e.constrain(o,0,1),l[r][i]=o<t.threshold?0:o}}return l},G=(e,t)=>{let l=e,a=e;for(let e=0;e<t.blurIterations;e++){a=l.map(e=>[...e]);for(let e=1;e<t.canvasSize-1;e++)for(let s=1;s<t.canvasSize-1;s++)a[e][s]=(3*l[e][s]+l[e-1][s]+l[e+1][s]+l[e][s-1]+l[e][s+1]+l[e-1][s-1]+l[e-1][s+1]+l[e+1][s-1]+l[e+1][s+1])/11;l=a}return a},L=(e,t,l,a)=>{let s=e.length;for(let t=0;t<s;t++)for(let n=0;n<s;n++)if(l[t][n]>0){let s=5e-4*a.erosionRate*l[t][n];e[t][n]=Math.max(0,e[t][n]-s)}return e},K=(e,t)=>{let l=t.canvasSize,a=Array(l).fill(null).map(()=>Array(l).fill(!1)),s=[{x:l-1,y:0}];for(;s.length>0;){let{x:t,y:n}=s.shift();if(!a[t][n]&&!(e[t][n]>.001))for(let e of(a[t][n]=!0,[{x:t-1,y:n},{x:t+1,y:n},{x:t,y:n-1},{x:t,y:n+1}]))e.x>=0&&e.x<l&&e.y>=0&&e.y<l&&s.push(e)}return a},B=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,_=(e,t)=>{let l=e.length,a=[];for(let s=0;s<l;s++)for(let n=0;n<l;n++)e[s][n]>t.threshold&&a.push({x:s,y:n});if(0===a.length)throw Error("No land tiles available to place the town square.");let s=B(0,a.length-1);return a[s]},q=(e,t,l,a)=>{let s=e.length,n=t,r=0;for(let i=-a;i<=a;i++)if(!(i>-l)||!(i<l))for(let o=-a;o<=a;o++){if(o>-l&&o<l)continue;let a=t.x+i,c=t.y+o;a>=0&&c>=0&&a<s&&c<s&&e[a][c]>r&&(r=e[a][c],n={x:a,y:c})}return n},P=e=>G(F(new(A())(e=>{}),e),e),T=(e,t)=>{let l=e.length,a=e[0].length,s=Array.from({length:l},()=>Array(a).fill(null));for(let n=0;n<l;n++)for(let r=0;r<a;r++){if(t[n][r])continue;let i=-1/0,o=null;for(let s=0;s<f.nK.length;s++){let[c,d]=f.nK[s],u=n+c,x=r+d;if(u>=0&&u<l&&x>=0&&x<a){let l=t[u][x]?1:e[n][r]-e[u][x];l>i&&(i=l,o=s)}}if(null!==o){let[t,l]=f.nK[o];e[n+t][r+l],e[n][r],i<1e-6?s[n][r]=null:s[n][r]=o}e[n][r]>1e-4&&s[n][r]}return s},W=(e,t)=>{let l=e.length,a=e[0].length,s=Array.from({length:l},()=>Array(a).fill(0));for(let n=0;n<l;n++)for(let r=0;r<a;r++){if(null===e[n][r])continue;let i=n,o=r;for(;;){let n=e[i][o];if(null===n)break;let[r,c]=f.nK[n],d=i+r,u=o+c;if(d<0||d>=l||u<0||u>=a)break;t[d][u]>t[i][o]&&console.error("BIG ERROR"),s[d][u]+=1,i=d,o=u}}return s};var Y=e=>{let[t,l]=(0,s.useState)(e.params.noiseScale),[h,m]=(0,s.useState)(e.params.canvasSize),[v,w]=(0,s.useState)(e.params.threshold),[C,D]=(0,s.useState)(e.params.maxDistanceFactor),[E,M]=(0,s.useState)(e.params.blurIterations),[A,F]=(0,s.useState)(e.params.erosionRate),[G,B]=(0,s.useState)(e.params.erosionIterations),[Y,H]=(0,s.useState)(f.ob),[O,Q]=(0,s.useState)(f.KT),[U,$]=(0,s.useState)(f.VB),[J,X]=x(),[Z,ee]=x();return((0,s.useEffect)(()=>{e.onColorsChanged({terrainGradient:Y,ambientLight:O,directionalLight:U})},[Y,O,U]),(0,s.useEffect)(()=>{e.onParamsChanged({noiseScale:t,canvasSize:h,threshold:v,maxDistanceFactor:C,blurIterations:E,erosionRate:A,erosionIterations:G})},[t,h,v,C,E,A]),(0,s.useEffect)(()=>{l(e.params.noiseScale),m(e.params.canvasSize),w(e.params.threshold),D(e.params.maxDistanceFactor),M(e.params.blurIterations)},[e.params]),e.display)?(0,a.jsx)("div",{id:"island-generator-container",className:"h-full",tabIndex:1,children:(0,a.jsxs)("div",{className:"border h-full flex flex-col",children:[(0,a.jsx)("div",{className:"w-full p-2",children:(0,a.jsx)(g.z,{className:"w-full pt-6 pb-6 border",style:{backgroundColor:"#0000aa"},onClick:()=>{let l={noiseScale:t,canvasSize:h,threshold:v,maxDistanceFactor:C,blurIterations:E,erosionRate:A,erosionIterations:G},a=P(l),s=K(a,l),x=a,m=T(x,s),p=W(m,x),g=L(x,m,p,l);if(l.erosionIterations>1)for(let e=0;e<l.erosionIterations;e++)p=W(m=T(x=g,s),x),g=L(x,m,p,l);let b=_(g,l),j=null,y=null,N=null;for(let e=0;e<5&&(N=q(g,b,f.Br,f.ip),null===(j=function(e,t,l,a){let s=new n;s.put(e,0);let f=new Map,x=new Map,h=d(e);for(d(t),f.set(h,null),x.set(h,0);!s.isEmpty();){let a=s.get();if(c(a,t))return u(f,e,t);for(let e of r(a,l)){let n=o(a,e);if(Math.abs(Math.abs((l[e.y][e.x]-l[a.y][a.x])/n))>999)continue;l[e.y][e.x];let r=(x.get(d(a))||0)+i(a,e,l),c=d(e);if(!x.has(c)||r<(x.get(c)||1/0)){x.set(c,r);let l=r+o(e,t);s.put(e,l),f.set(c,a)}}}return null}(b,N,g,0)));e+=1);for(let e=0;e<5&&null===(y=function(e,t,l,a){let s=new n;s.put(e,0);let c=new Map,f=new Map,x=d(e);for(c.set(x,null),f.set(x,0);!s.isEmpty();){let a=s.get();if(l[a.x][a.y]<1e-4)return u(c,e,a);for(let e of r(a,l)){o(a,e),l[e.y][e.x],l[a.y][a.x];let n=(f.get(d(a))||0)+i(a,e,l),r=d(e);if(!f.has(r)||n<(f.get(r)||1/0)){f.set(r,n);let l=n+function(e,t){let l=1/0;for(let a=0;a<t.length;a++)for(let s=0;s<t[0].length;s++)if(t[a][s]){let t=o(e,{x:s,y:a});t<l&&(l=t)}return l}(e,t);s.put(e,l),c.set(r,a)}}}return null}(b,s,g,0));e+=1);e.onWorldGenerated({heightmap:g,oceanTiles:s,flowDirections:m,waterAccumulation:p,townSquare:b,temple:N,docks:y?y[(null==y?void 0:y.length)-1]:null,templePath:j,docksPath:y})},children:(0,a.jsx)("div",{className:" text-2xl font-extrabold",children:"Generate"})})}),(0,a.jsxs)(b,{defaultValue:"worldgen",className:"flex-1 flex flex-col p-2",children:[(0,a.jsxs)(j,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(y,{ref:J,value:"worldgen",children:X>100?"\uD83C\uDF10 Parameters":"\uD83C\uDF10"}),(0,a.jsx)(y,{ref:Z,value:"colors",children:ee>100?"\uD83C\uDFA8 Colors":"\uD83C\uDFA8"})]}),(0,a.jsxs)(N,{value:"worldgen",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Noise Scale: ",t]}),(0,a.jsx)(p,{className:"p-2",min:.01,max:.3,step:.01,value:[t],onValueChange:e=>l(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Canvas Size: ",h]}),(0,a.jsx)(p,{className:"p-2",min:0,max:800,step:25,value:[h],onValueChange:e=>m(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Max Distance Factor: ",C]}),(0,a.jsx)(p,{className:"p-2",min:.5,max:2,step:.1,value:[C],onValueChange:e=>D(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Threshold: ",v]}),(0,a.jsx)(p,{className:"p-2",min:0,max:1,step:.05,value:[v],onValueChange:e=>w(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Blur Iterations: ",E]}),(0,a.jsx)(p,{className:"p-2",min:0,max:10,step:1,value:[E],onValueChange:e=>{M(e[0])}})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Erosion Rate: ",A]}),(0,a.jsx)(p,{className:"p-2",min:0,max:1,step:.01,value:[A],onValueChange:e=>{F(e[0])}})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Erosion Iterations: ",G]}),(0,a.jsx)(p,{className:"p-2",min:1,max:10,step:1,value:[G],onValueChange:e=>{B(e[0])}})]})})]}),(0,a.jsxs)(N,{value:"colors",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,a.jsx)(I,{text:"Ambient Light",value:O,placeholder:f.KT,onChange:Q}),(0,a.jsx)(I,{text:"Directional Light",value:U,placeholder:f.VB,onChange:$}),(0,a.jsx)(S,{type:"single",collapsible:!0,className:"w-full",children:(0,a.jsxs)(z,{value:"item-1",children:[(0,a.jsxs)(k,{className:"flex",children:[(0,a.jsx)("div",{className:"w-1/2 text-start",children:"Gradient"}),(0,a.jsx)("div",{className:"w-1/2 border h-full rounded-md mr-2 ml-4",style:{background:"linear-gradient(180deg, ".concat(Y[3],", ").concat(Y[2],", ").concat(Y[1],", ").concat(Y[0],")")}})]}),(0,a.jsx)(R,{children:(0,a.jsx)(V,{currentGradient:Y,onChange:e=>{H(e)}})})]})})]})]})]})}):(0,a.jsx)(a.Fragment,{})}}}]);