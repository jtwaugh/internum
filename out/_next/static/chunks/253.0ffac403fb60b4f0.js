"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{8253:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var n,a,l=r(7437),c=r(2265),o=r(7776),i=r(8938),u=r(9733),s=r(1648);let d=(e,t,r)=>{let n=e.distanceTo(t),a=new o.fHI(.5,.5,n,32),l=new o.vBJ({color:r}),c=new o.Kj0(a,l),i=new o.Pa4().addVectors(e,t).multiplyScalar(.5);c.position.copy(i);let u=new o.Pa4().subVectors(t,e).normalize(),s=new o.Pa4(0,1,0).cross(u).normalize(),d=Math.acos(new o.Pa4(0,1,0).dot(u));return c.quaternion.setFromAxisAngle(s,d),c},h=(e,t)=>{let r=t.geometry,n=new o.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.heightmap.length-e.townSquare.y]*s.Vl),a=new o.Pa4(e.docks.x-r.parameters.width/2,e.heightmap.length-e.docks.y-r.parameters.height/2,e.heightmap[e.docks.x][e.heightmap.length-e.docks.y]*s.Vl),l=new o.Pa4(e.temple.x-r.parameters.width/2,e.heightmap.length-e.temple.y-r.parameters.height/2,e.heightmap[e.temple.x][e.heightmap.length-e.temple.y]*s.Vl),c=new o.Pa4(n.x,n.y,n.z+10),i=new o.Pa4(a.x,a.y,a.z+10),u=new o.Pa4(l.x,l.y,l.z+10);return[d(n,c,16711935),d(a,i,65535),d(l,u,16776960)]},p=(e,t,r)=>{let n=t.geometry,a=new o.Pa4(e.temple.x-n.parameters.width/2,e.heightmap.length-e.temple.y-n.parameters.height/2,e.heightmap[e.temple.x][e.temple.y]*s.Vl),l=new o.Wid({color:16773358,roughness:.5,metalness:.1}),c=new o.fHI(15/r,13/r,2/r,32),i=new o.Kj0(c,l);i.position.set(a.x,a.y,a.z),i.rotation.x=-Math.PI/2;let u=new o.fHI(.5/r,.5/r,10/r,32),d=12/r,h=[];for(let e=0;e<12;e++){let t=e/12*2*Math.PI,n=d*Math.cos(t)+a.x,c=d*Math.sin(t)+a.y,i=new o.Kj0(u,l);i.position.set(n,c,a.z+5/r),i.rotation.x=-Math.PI/2,h=h.concat(i)}return[i,h]},g=(e,t)=>{let r=t.geometry,n=new o.Wid({color:16773358,roughness:.5,metalness:.1}),a=new o.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.townSquare.y]*s.Vl),l=new o.DvJ(1.2,1.2,.1),c=new o.Kj0(l,n);return c.position.set(a.x,a.y,a.z),c},m=(e,t,r)=>{r=Math.min(Math.max(r,0),1);let n=parseInt(e.substring(1),16),a=parseInt(t.substring(1),16),l=n>>16&255,c=n>>8&255,o=255&n,i=Math.round(l+r*((a>>16&255)-l)),u=Math.round(c+r*((a>>8&255)-c)),s=Math.round(o+r*((255&a)-o));return"#".concat((i<<16|u<<8|s).toString(16).padStart(6,"0"))},w=(e,t)=>{console.log(t);let r=e.heightmap.length,n=new o._12(r,r,r-1,r-1),a=[];for(let l=0;l<n.attributes.position.array.length;l+=3){let c;let i=Math.floor(l/3%r),u=Math.floor(l/3/r);n.attributes.position.setZ(l/3,10*e.heightmap[i][u]),c=new o.Ilk(e.heightmap[i][u]<.001?t.terrainGradient[0]:e.heightmap[i][u]<.5?m(t.terrainGradient[1],t.terrainGradient[2],2*e.heightmap[i][u]):m(t.terrainGradient[2],t.terrainGradient[3],(e.heightmap[i][u]-.5)*2)),i===e.townSquare.x&&u===e.townSquare.y&&(c=new o.Ilk(16711935)),a.push(c.r,c.g,c.b)}n.setAttribute("color",new o.a$l(a,3)),n.computeVertexNormals();let l=new o.YBo({vertexColors:!0,flatShading:!0});return new o.Kj0(n,l)};(n=a||(a={}))[n.FreeFloat=0]="FreeFloat",n[n.FreeFall=1]="FreeFall",n[n.Walking=2]="Walking";var f=e=>{let t=(0,c.useRef)(null),r=(0,c.useRef)(null);document.getElementById("fullscreen-btn");let[n,a]=(0,c.useState)(!1),s=(0,c.useRef)(null),d=(0,c.useRef)(e.colorsConfig),m=(0,c.useRef)(null),f=(0,c.useRef)(null),x=(0,c.useRef)(null),b=(0,c.useRef)(null),y=(0,c.useRef)(null),v=(0,c.useRef)(null),S=(0,c.useRef)(null),k=(0,c.useRef)(null);(0,c.useRef)(null);let P=(0,c.useRef)(0),z=()=>{v.current.fov=75,v.current.aspect=1.5,v.current.near=.1,v.current.far=1e3,v.current.position.set(0,0,100)},j=(0,c.useRef)(0),M=()=>{var e,n,a;let l=null===(e=t.current)||void 0===e?void 0:e.clientWidth,c=null===(n=t.current)||void 0===n?void 0:n.clientHeight;null===(a=r.current)||void 0===a||a.setSize(l,c),v.current.aspect=l/c,v.current.updateProjectionMatrix()};return(0,c.useEffect)(()=>{d.current=e.colorsConfig,console.log(e.colorsConfig)},[e.colorsConfig]),(0,c.useEffect)(()=>{let e=new o.CP7({antialias:!0});r.current=e,t.current.appendChild(r.current.domElement);let n=new o.xsS,a=new o.Mig(d.current.ambientLight);n.add(a),f.current=a;let l=new o.Ox3(d.current.directionalLight,100);l.position.set(50,50,50),n.add(l),x.current=l,m.current=n;let c=new o.cPb(75,1.5,.1,1e3);c.position.set(0,0,100),v.current=c,M();let u=new i.z(c,r.current.domElement);u.enableDamping=!0,u.dampingFactor=.05,k.current=u;let s=e=>{if(v.current&&S.current){if(S.current instanceof i.z)switch(e.key){case"w":let t=new o.Pa4(0,1,0);S.current.target.addScaledVector(t,10),v.current.position.addScaledVector(t,10);break;case"s":let r=new o.Pa4(0,-1,0);S.current.target.addScaledVector(r,10),v.current.position.addScaledVector(r,10);break;case"a":let n=new o.Pa4(-1,0,0);S.current.target.addScaledVector(n,10),v.current.position.addScaledVector(n,10);break;case"d":let a=new o.Pa4(1,0,0);S.current.target.addScaledVector(a,10),v.current.position.addScaledVector(a,10)}k.current.update()}};return window.addEventListener("resize",M),S.current=u,P.current=0,()=>{var n;window.removeEventListener("keydown",s),null===(n=t.current)||void 0===n||n.removeChild(e.domElement),r.current.dispose()}},[]),(0,c.useEffect)(()=>{let e=new o.Mig(d.current.ambientLight);f.current=e},[e.colorsConfig.ambientLight]),(0,c.useEffect)(()=>{let e=new o.Ox3(d.current.directionalLight);x.current=e},[e.colorsConfig.directionalLight]),(0,c.useEffect)(()=>{let n;if(m.current)for(;m.current.children.length>0;)m.current.remove(m.current.children[0]);if(P.current=0,z(),k.current.enabled=!0,!t.current||!e.world||!r.current)return;if(b.current=new o.SUY,e.world.heightmap&&m.current){console.log(d.current);let t=w(e.world,d.current);y.current=t,m.current.add(t);{let[r,n,a]=h(e.world,t);m.current.add(r),m.current.add(n),m.current.add(a)}let[r,n]=p(e.world,t,12);m.current.add(r),n.forEach(e=>{m.current.add(e)});let a=g(e.world,t);m.current.add(a),f.current&&m.current.add(f.current),x.current&&m.current.add(x.current)}let a=()=>{n=requestAnimationFrame(a);let e=b.current.getDelta();if(1===P.current){j.current+=9.81*e,v.current.position.z-=j.current*e;let t=new o.Pa4(0,0,-1),r=new o.iMs;r.set(v.current.position,t);let n=r.intersectObject(y.current);n.length>0&&n[0].distance<=j.current*e&&(v.current.position.z=5,v.current.lookAt(new o.Pa4(1,0,0)),P.current=2,j.current=0)}else k.current.update();r.current.render(m.current,v.current)};return a(),()=>cancelAnimationFrame(n)},[e.world]),(0,l.jsx)("div",{ref:s,id:"three-container",tabIndex:0,className:"p-4 flex-1",children:(0,l.jsxs)("div",{className:"h-full justify-center",children:[(0,l.jsx)("div",{id:"fullscreen-button-container",className:"relative",children:(0,l.jsx)(u.z,{id:"fullscreen-btn",onClick:()=>{},className:"absolute top-1 right-2 z-10 p-4 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",children:"『』"})}),(0,l.jsx)("div",{ref:t,className:"h-full w-full"}),(0,l.jsx)("div",{id:"buttons-container",className:"relative",children:(0,l.jsxs)("div",{className:"flex p-4 absolute bottom-1 left-1 z-10",children:[(0,l.jsx)(u.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{v.current&&S.current&&(z(),P.current=0,v.current.updateProjectionMatrix(),k.current.reset(),k.current.enabled=!0,S.current=k.current)},children:"\uD83D\uDDFA️"}),(0,l.jsx)(u.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{if(!v.current||!S.current||!e.world||!y.current)return;let t=new o.Pa4(e.world.townSquare.x-y.current.geometry.parameters.width/2,e.world.heightmap.length-e.world.townSquare.y-y.current.geometry.parameters.height/2,10);v.current.position.set(t.x,t.y,50),k.current.target.copy(t),k.current.update()},children:"\uD83C\uDFD8️"}),(0,l.jsx)(u.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{k.current.enabled=!1,P.current=1,console.log("Free fall")},children:"\uD83E\uDE82"})]})})]})})}}}]);