"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19],{5019:function(e,l,a){a.r(l),a.d(l,{default:function(){return K}});var t=a(7437),s=a(2265),r=a(1648);let n=()=>{let[e,l]=(0,s.useState)(0),a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=()=>{a.current&&l(a.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),[a,e]};var i=a(5068),o=a(9354);let c=s.forwardRef((e,l)=>{let{className:a,...s}=e;return(0,t.jsxs)(i.fC,{ref:l,className:(0,o.cn)("relative flex w-full touch-none select-none items-center",a),...s,children:[(0,t.jsx)(i.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,t.jsx)(i.e6,{className:"absolute h-full bg-primary"})}),(0,t.jsx)(i.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});c.displayName=i.fC.displayName;var d=a(9733),u=a(2447);let f=u.fC,x=s.forwardRef((e,l)=>{let{className:a,...s}=e;return(0,t.jsx)(u.aV,{ref:l,className:(0,o.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...s})});x.displayName=u.aV.displayName;let m=s.forwardRef((e,l)=>{let{className:a,...s}=e;return(0,t.jsx)(u.xz,{ref:l,className:(0,o.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...s})});m.displayName=u.xz.displayName;let h=s.forwardRef((e,l)=>{let{className:a,...s}=e;return(0,t.jsx)(u.VY,{ref:l,className:(0,o.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});h.displayName=u.VY.displayName;var p=a(4756),g=a(4867);let b=p.fC,v=s.forwardRef((e,l)=>{let{className:a,...s}=e;return(0,t.jsx)(p.ck,{ref:l,className:(0,o.cn)("border-b",a),...s})});v.displayName="AccordionItem";let j=s.forwardRef((e,l)=>{let{className:a,children:s,...r}=e;return(0,t.jsx)(p.h4,{className:"flex",children:(0,t.jsxs)(p.xz,{ref:l,className:(0,o.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...r,children:[s,(0,t.jsx)(g.v4q,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})});j.displayName=p.xz.displayName;let N=s.forwardRef((e,l)=>{let{className:a,children:s,...r}=e;return(0,t.jsx)(p.VY,{ref:l,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:(0,t.jsx)("div",{className:(0,o.cn)("pb-4 pt-0",a),children:s})})});N.displayName=p.VY.displayName;let w=s.forwardRef((e,l)=>{let{className:a,type:s,...r}=e;return(0,t.jsx)("input",{type:s,className:(0,o.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:l,...r})});w.displayName="Input";var y=a(402);let S=e=>{let[l,a]=(0,s.useState)(e.value);return(0,t.jsxs)("div",{className:"mb-4 flex space-x-2",children:[(0,t.jsx)("div",{className:"flex items-center justify-start w-1/2",children:(0,t.jsx)(y._,{className:"items-center text-xs font-semibold",children:e.text})}),(0,t.jsx)("div",{className:"flex items-center justify-end w-1/2",children:(0,t.jsx)("div",{className:"flex items-center space-x-4 resize-none",children:(0,t.jsx)(w,{className:"border leading-tight text-xs",value:l,onChange:l=>{let t=l.target.value.toLowerCase();a(t=t.startsWith("#")?"#"+t.slice(1).replace(/[^0-9a-f]/gi,""):"#"+t.replace(/[^0-9a-f]/gi,"")),/^#[0-9a-f]{6}$/i.test(t)&&e.onChange(t)},placeholder:e.placeholder})})}),(0,t.jsx)("div",{className:"w-[10px] rounded-full border",style:{backgroundColor:l}})]})};var C=e=>{let[l,a]=(0,s.useState)(e.currentGradient[0]),[n,i]=(0,s.useState)(e.currentGradient[1]),[o,c]=(0,s.useState)(e.currentGradient[2]),[d,u]=(0,s.useState)(e.currentGradient[3]);return(0,s.useEffect)(()=>{e.onChange([l,n,o,d])},[l,n,o,d]),(0,t.jsxs)("div",{children:[(0,t.jsx)(S,{text:"Highlands",value:d,placeholder:r.ob[3],onChange:u}),(0,t.jsx)(S,{text:"Midlands",value:o,placeholder:r.ob[2],onChange:c}),(0,t.jsx)(S,{text:"Lowlands",value:n,placeholder:r.ob[1],onChange:i}),(0,t.jsx)(S,{text:"Water",value:l,placeholder:r.ob[0],onChange:a})]})},z=a(7020),k=a.n(z);let D=(e,l)=>{let a=[],t=l.canvasSize/2,s=l.canvasSize/2,r=e.dist(0,0,t,s)*l.maxDistanceFactor;for(let n=0;n<l.canvasSize;n++){a[n]=[];for(let i=0;i<l.canvasSize;i++){let o=e.noise(n*l.noiseScale,i*l.noiseScale)-e.dist(n,i,t,s)/r;o=e.constrain(o,0,1),a[n][i]=o<l.threshold?0:o}}return a},R=(e,l)=>{let a=e,t=e;for(let e=0;e<l.blurIterations;e++){t=a.map(e=>[...e]);for(let e=1;e<l.canvasSize-1;e++)for(let s=1;s<l.canvasSize-1;s++)t[e][s]=(3*a[e][s]+a[e-1][s]+a[e+1][s]+a[e][s-1]+a[e][s+1]+a[e-1][s-1]+a[e-1][s+1]+a[e+1][s-1]+a[e+1][s+1])/11;a=t}return t},V=(e,l)=>{let a=l.canvasSize,t=Array(a).fill(null).map(()=>Array(a).fill(!1)),s=[{x:a-1,y:0}];for(;s.length>0;){let{x:l,y:r}=s.shift();if(!t[l][r]&&!(e[l][r]>.001))for(let e of(t[l][r]=!0,[{x:l-1,y:r},{x:l+1,y:r},{x:l,y:r-1},{x:l,y:r+1}]))e.x>=0&&e.x<a&&e.y>=0&&e.y<a&&s.push(e)}return t},E=(e,l)=>Math.floor(Math.random()*(l-e+1))+e,A=(e,l)=>{let a=e.length,t=[];for(let s=0;s<a;s++)for(let r=0;r<a;r++)e[s][r]>l.threshold&&t.push({x:s,y:r});if(0===t.length)throw Error("No land tiles available to place the town square.");let s=E(0,t.length-1);return t[s]},F=(e,l,a,t)=>{let s=e.length,r=l,n=e[l.x][l.y];for(let i=-t;i<=t;i++)if(!(i>-a)||!(i<a))for(let o=-t;o<=t;o++){if(o>-a&&o<a)continue;let t=l.x+i,c=l.y+o;t>=0&&c>=0&&t<s&&c<s&&e[t][c]>n&&(n=e[t][c],r={x:t,y:c})}return r},G=(e,l,a)=>{let t=V(e,a),s=e.length,r=null,n=1/0;for(let e=0;e<s;e++)for(let a=0;a<s;a++)if(t[e][a]){let t=Math.abs(e-l.x)+Math.abs(a-l.y);t<n&&(n=t,r={x:e,y:a})}return r},I=e=>R(D(new(k())(e=>{}),e),e),B=e=>{let l=e=>e>1e-4,a=e.length,t=e[0].length,s=Array.from({length:a},()=>Array(t).fill(null));for(let n=0;n<a;n++)for(let i=0;i<t;i++){if(!l(e[n][i]))continue;let o=-1/0,c=null;for(let l=0;l<r.nK.length;l++){let[s,d]=r.nK[l],u=n+s,f=i+d;if(u>=0&&u<a&&f>=0&&f<t){let a=e[u][f]>1e-4?e[n][i]-e[u][f]:1;console.log("Slope from (",n,", ",i,") to (",u,", ",f,"): ",a),a>o?(o=a,c=l):console.log("Slope ",a," is not steeper the max ",o)}}if(null!==c){let[l,a]=r.nK[c];console.log("Best direction is ",c," i.e. water will flow from (",n,", ",i,") to (",n+l,", ",i+a,")"),e[n+l][i+a]>e[n][i]&&console.error("BIG ERROR"),o<1e-6?(console.log("Basin!"),s[n][i]=null):(console.log("Winner! ",c),s[n][i]=c)}e[n][i]>1e-4&&s[n][i]}return s},L=(e,l)=>{let a=e.length,t=e[0].length,s=Array.from({length:a},()=>Array(t).fill(0));for(let n=0;n<a;n++)for(let i=0;i<t;i++){if(null===e[n][i])continue;let o=n,c=i;for(;;){let d=e[o][c];if(null===d)break;let[u,f]=r.nK[d],x=o+u,m=c+f;if(console.log("Direction from (",o,", ",c,") is ",d," i.e. water will flow to (",x,", ",m,")"),x<0||x>=a||m<0||m>=t)break;l[x][m]>l[o][c]&&console.error("BIG ERROR"),s[x][m]+=1,console.log("Starting from rainfall on cell (",n,", ",i,") accumulated 1 water unit from cell (",o,", ",c,") (height ",l[o][c],") to cell (",x,", ",m,") (height ",l[x][m],")"),o=x,c=m}}return console.log(s),s};var K=e=>{let[l,a]=(0,s.useState)(e.params.noiseScale),[i,o]=(0,s.useState)(e.params.canvasSize),[u,p]=(0,s.useState)(e.params.threshold),[g,w]=(0,s.useState)(e.params.maxDistanceFactor),[y,z]=(0,s.useState)(e.params.blurIterations),[k,D]=(0,s.useState)(r.ob),[R,V]=(0,s.useState)(r.KT),[E,K]=(0,s.useState)(r.VB),[M,W]=n(),[_,Y]=n();return((0,s.useEffect)(()=>{e.onColorsChanged({terrainGradient:k,ambientLight:R,directionalLight:E})},[k,R,E]),(0,s.useEffect)(()=>{e.onParamsChanged({noiseScale:l,canvasSize:i,threshold:u,maxDistanceFactor:g,blurIterations:y})},[l,i,u,g,y]),(0,s.useEffect)(()=>{a(e.params.noiseScale),o(e.params.canvasSize),p(e.params.threshold),w(e.params.maxDistanceFactor),z(e.params.blurIterations)},[e.params]),e.display)?(0,t.jsx)("div",{id:"island-generator-container",className:"h-full",tabIndex:1,children:(0,t.jsxs)("div",{className:"border h-full flex flex-col",children:[(0,t.jsx)("div",{className:"w-full p-2",children:(0,t.jsx)(d.z,{className:"w-full pt-6 pb-6 border",style:{backgroundColor:"#0000aa"},onClick:()=>{let a={noiseScale:l,canvasSize:i,threshold:u,maxDistanceFactor:g,blurIterations:y},t=I(a);console.log(JSON.stringify(t));let s=B(t),n=L(s,t),o=A(t,a),c=F(t,o,r.Br,r.ip),d=G(t,o,a);e.onWorldGenerated({heightmap:t,flowDirections:s,waterAccumulation:n,townSquare:o,temple:c,docks:d})},children:(0,t.jsx)("div",{className:" text-2xl font-extrabold",children:"Generate"})})}),(0,t.jsxs)(f,{defaultValue:"worldgen",className:"flex-1 flex flex-col p-2",children:[(0,t.jsxs)(x,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(m,{ref:M,value:"worldgen",children:W>100?"\uD83C\uDF10 Parameters":"\uD83C\uDF10"}),(0,t.jsx)(m,{ref:_,value:"colors",children:Y>100?"\uD83C\uDFA8 Colors":"\uD83C\uDFA8"})]}),(0,t.jsxs)(h,{value:"worldgen",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("label",{children:[(0,t.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Noise Scale: ",l]}),(0,t.jsx)(c,{className:"p-2",min:.01,max:.3,step:.01,value:[l],onValueChange:e=>a(e[0])})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{children:[(0,t.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Canvas Size: ",i]}),(0,t.jsx)(c,{className:"p-2",min:0,max:800,step:25,value:[i],onValueChange:e=>o(e[0])})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{children:[(0,t.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Max Distance Factor: ",g]}),(0,t.jsx)(c,{className:"p-2",min:.5,max:2,step:.1,value:[g],onValueChange:e=>w(e[0])})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{children:[(0,t.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Threshold: ",u]}),(0,t.jsx)(c,{className:"p-2",min:0,max:1,step:.05,value:[u],onValueChange:e=>p(e[0])})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{children:[(0,t.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Blur Iterations: ",y]}),(0,t.jsx)(c,{className:"p-2",min:0,max:10,step:1,value:[y],onValueChange:e=>{z(e[0])}})]})})]}),(0,t.jsxs)(h,{value:"colors",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,t.jsx)(S,{text:"Ambient Light",value:R,placeholder:r.KT,onChange:V}),(0,t.jsx)(S,{text:"Directional Light",value:E,placeholder:r.VB,onChange:K}),(0,t.jsx)(b,{type:"single",collapsible:!0,className:"w-full",children:(0,t.jsxs)(v,{value:"item-1",children:[(0,t.jsxs)(j,{className:"flex",children:[(0,t.jsx)("div",{className:"w-1/2 text-start",children:"Gradient"}),(0,t.jsx)("div",{className:"w-1/2 border h-full rounded-md mr-2 ml-4",style:{background:"linear-gradient(180deg, ".concat(k[3],", ").concat(k[2],", ").concat(k[1],", ").concat(k[0],")")}})]}),(0,t.jsx)(N,{children:(0,t.jsx)(C,{currentGradient:k,onChange:e=>{D(e)}})})]})})]})]})]})}):(0,t.jsx)(t.Fragment,{})}}}]);