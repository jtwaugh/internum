"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{3353:function(e,t,l){l.r(t),l.d(t,{default:function(){return M}});var a=l(7437),s=l(2265);class n{isEmpty(){return 0===this.elements.length}put(e,t){this.elements.push({item:e,priority:t}),this.elements.sort((e,t)=>e.priority-t.priority)}get(){var e;return null===(e=this.elements.shift())||void 0===e?void 0:e.item}constructor(){this.elements=[]}}function r(e,t){let l=[],{x:a,y:s}=e;for(let e of[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0},{x:1,y:1},{x:1,y:-1},{x:-1,y:1},{x:-1,y:-1}]){let n=a+e.x,r=s+e.y;n>=0&&r>=0&&n<t[0].length&&r<t.length&&l.push({x:n,y:r})}return l}function o(e,t,l){return i(e,t)+Math.abs(l[t.y][t.x]-l[e.y][e.x])}function i(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function c(e,t){return e.x===t.x&&e.y===t.y}function u(e){return"".concat(e.x,",").concat(e.y)}function d(e,t,l){let a=l,s=[];for(;a&&!c(a,t);)s.push(a),a=e.get(u(a))||null;s.push(t);let n=s.reverse();return console.log(n),n}var f=l(1648);let x=()=>{let[e,t]=(0,s.useState)(0),l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=()=>{l.current&&t(l.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),[l,e]};var h=l(5068),m=l(9354);let p=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsxs)(h.fC,{ref:t,className:(0,m.cn)("relative flex w-full touch-none select-none items-center",l),...s,children:[(0,a.jsx)(h.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,a.jsx)(h.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(h.bU,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});p.displayName=h.fC.displayName;var g=l(9733),v=l(2447);let b=v.fC,j=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(v.aV,{ref:t,className:(0,m.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",l),...s})});j.displayName=v.aV.displayName;let y=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(v.xz,{ref:t,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",l),...s})});y.displayName=v.xz.displayName;let N=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(v.VY,{ref:t,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l),...s})});N.displayName=v.VY.displayName;var w=l(4756),C=l(4867);let S=w.fC,z=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(w.ck,{ref:t,className:(0,m.cn)("border-b",l),...s})});z.displayName="AccordionItem";let k=s.forwardRef((e,t)=>{let{className:l,children:s,...n}=e;return(0,a.jsx)(w.h4,{className:"flex",children:(0,a.jsxs)(w.xz,{ref:t,className:(0,m.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",l),...n,children:[s,(0,a.jsx)(C.v4q,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})});k.displayName=w.xz.displayName;let D=s.forwardRef((e,t)=>{let{className:l,children:s,...n}=e;return(0,a.jsx)(w.VY,{ref:t,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,a.jsx)("div",{className:(0,m.cn)("pb-4 pt-0",l),children:s})})});D.displayName=w.VY.displayName;let R=s.forwardRef((e,t)=>{let{className:l,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,m.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",l),ref:t,...n})});R.displayName="Input";var V=l(402);let E=e=>{let[t,l]=(0,s.useState)(e.value);return(0,a.jsxs)("div",{className:"mb-4 flex space-x-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-start w-1/2",children:(0,a.jsx)(V._,{className:"items-center text-xs font-semibold",children:e.text})}),(0,a.jsx)("div",{className:"flex items-center justify-end w-1/2",children:(0,a.jsx)("div",{className:"flex items-center space-x-4 resize-none",children:(0,a.jsx)(R,{className:"border leading-tight text-xs",value:t,onChange:t=>{let a=t.target.value.toLowerCase();l(a=a.startsWith("#")?"#"+a.slice(1).replace(/[^0-9a-f]/gi,""):"#"+a.replace(/[^0-9a-f]/gi,"")),/^#[0-9a-f]{6}$/i.test(a)&&e.onChange(a)},placeholder:e.placeholder})})}),(0,a.jsx)("div",{className:"w-[10px] rounded-full border",style:{backgroundColor:t}})]})};var I=e=>{let[t,l]=(0,s.useState)(e.currentGradient[0]),[n,r]=(0,s.useState)(e.currentGradient[1]),[o,i]=(0,s.useState)(e.currentGradient[2]),[c,u]=(0,s.useState)(e.currentGradient[3]);return(0,s.useEffect)(()=>{e.onChange([t,n,o,c])},[t,n,o,c]),(0,a.jsxs)("div",{children:[(0,a.jsx)(E,{text:"Highlands",value:c,placeholder:f.ob[3],onChange:u}),(0,a.jsx)(E,{text:"Midlands",value:o,placeholder:f.ob[2],onChange:i}),(0,a.jsx)(E,{text:"Lowlands",value:n,placeholder:f.ob[1],onChange:r}),(0,a.jsx)(E,{text:"Water",value:t,placeholder:f.ob[0],onChange:l})]})},L=l(9923),M=e=>{let[t,l]=(0,s.useState)(e.params.noiseScale),[h,m]=(0,s.useState)(e.params.canvasSize),[v,w]=(0,s.useState)(e.params.threshold),[C,R]=(0,s.useState)(e.params.waterLevel),[V,M]=(0,s.useState)(e.params.maxDistanceFactor),[A,F]=(0,s.useState)(e.params.blurIterations),[G,K]=(0,s.useState)(e.params.erosionRate),[Y,B]=(0,s.useState)(e.params.erosionIterations),[P,W]=(0,s.useState)(f.ob),[_,q]=(0,s.useState)(f.KT),[T,H]=(0,s.useState)(f.VB),[O,Q]=(0,s.useState)(f.bp),[U,$]=x(),[J,X]=x();return((0,s.useEffect)(()=>{e.onColorsChanged({terrainGradient:P,ambientLight:_,directionalLight:T,waterColor:O})},[P,_,T,O]),(0,s.useEffect)(()=>{e.onParamsChanged({noiseScale:t,canvasSize:h,threshold:v,waterLevel:C,maxDistanceFactor:V,blurIterations:A,erosionRate:G,erosionIterations:Y})},[t,h,v,V,A,G]),(0,s.useEffect)(()=>{l(e.params.noiseScale),m(e.params.canvasSize),w(e.params.threshold),M(e.params.maxDistanceFactor),F(e.params.blurIterations)},[e.params]),e.display)?(0,a.jsx)("div",{id:"island-generator-container",className:"h-full",tabIndex:1,children:(0,a.jsxs)("div",{className:"border h-full flex flex-col",children:[(0,a.jsx)("div",{className:"w-full p-2",children:(0,a.jsx)(g.z,{className:"w-full pt-6 pb-6 border",style:{backgroundColor:"#0000aa"},onClick:()=>{let l={noiseScale:t,canvasSize:h,threshold:v,waterLevel:C,maxDistanceFactor:V,blurIterations:A,erosionRate:G,erosionIterations:Y},a=(0,L.y5)(l),s=(0,L.R)(a,l),x=a,m=(0,L.aD)(x,l),p=(0,L.lY)(m,x),g=(0,L.sv)(x,m,p,l);if(l.erosionIterations>1)for(let e=0;e<l.erosionIterations;e++)x=g,m=(0,L.aD)(x,l),p=(0,L.lY)(m,x),g=(0,L.sv)(x,m,p,l);let b=(0,L.zl)(g,l.waterLevel),j=null,y=null,N=null;for(let e=0;e<5&&(N=(0,L.pP)(g,b,f.Br,f.ip),null===(j=function(e,t,l,a){let s=new n;s.put(e,0);let f=new Map,x=new Map,h=u(e);for(u(t),f.set(h,null),x.set(h,0);!s.isEmpty();){let a=s.get();if(c(a,t))return d(f,e,t);for(let e of r(a,l)){let n=i(a,e);if(Math.abs(Math.abs((l[e.y][e.x]-l[a.y][a.x])/n))>999)continue;l[e.y][e.x];let r=(x.get(u(a))||0)+o(a,e,l),c=u(e);if(!x.has(c)||r<(x.get(c)||1/0)){x.set(c,r);let l=r+i(e,t);s.put(e,l),f.set(c,a)}}}return null}(b,N,g,0)));e+=1);j&&(console.log("path to temple: ",j),console.log("temple coords: ",j[(null==j?void 0:j.length)-1]));for(let e=0;e<5&&null===(y=function(e,t,l,a){let s=new n;s.put(e,0);let c=new Map,f=new Map,x=u(e);for(c.set(x,null),f.set(x,0);!s.isEmpty();){let a=s.get();if(l[a.x][a.y]<1e-4)return d(c,e,a);for(let e of r(a,l)){i(a,e),l[e.y][e.x],l[a.y][a.x];let n=(f.get(u(a))||0)+o(a,e,l),r=u(e);if(!f.has(r)||n<(f.get(r)||1/0)){f.set(r,n);let l=n+function(e,t){let l=1/0;for(let a=0;a<t.length;a++)for(let s=0;s<t[0].length;s++)if(t[a][s]){let t=i(e,{x:s,y:a});t<l&&(l=t)}return l}(e,t);s.put(e,l),c.set(r,a)}}}return null}(b,s,g,0));e+=1);y&&(console.log("path to docks: ",y),console.log("docks coords: ",y[(null==y?void 0:y.length)-1])),e.onWorldGenerated({heightmap:g,waterLevel:l.waterLevel,oceanTiles:s,flowDirections:m,waterAccumulation:p,townSquare:b,temple:N,docks:y?y[(null==y?void 0:y.length)-1]:null,templePath:j,docksPath:y})},children:(0,a.jsx)("div",{className:" text-2xl font-extrabold",children:"Generate"})})}),(0,a.jsxs)(b,{defaultValue:"worldgen",className:"flex-1 flex flex-col p-2",children:[(0,a.jsxs)(j,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(y,{ref:U,value:"worldgen",children:$>100?"\uD83C\uDF10 Parameters":"\uD83C\uDF10"}),(0,a.jsx)(y,{ref:J,value:"colors",children:X>100?"\uD83C\uDFA8 Colors":"\uD83C\uDFA8"})]}),(0,a.jsxs)(N,{value:"worldgen",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Noise Scale: ",t]}),(0,a.jsx)(p,{className:"p-2",min:.01,max:.3,step:.01,value:[t],onValueChange:e=>l(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Canvas Size: ",h]}),(0,a.jsx)(p,{className:"p-2",min:0,max:800,step:25,value:[h],onValueChange:e=>m(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Max Distance Factor: ",V]}),(0,a.jsx)(p,{className:"p-2",min:.5,max:2,step:.1,value:[V],onValueChange:e=>M(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Threshold: ",v]}),(0,a.jsx)(p,{className:"p-2",min:0,max:1,step:.05,value:[v],onValueChange:e=>w(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Water level: ",C]}),(0,a.jsx)(p,{className:"p-2",min:0,max:1,step:.05,value:[C],onValueChange:e=>R(e[0])})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Blur Iterations: ",A]}),(0,a.jsx)(p,{className:"p-2",min:0,max:10,step:1,value:[A],onValueChange:e=>{F(e[0])}})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Erosion Rate: ",G]}),(0,a.jsx)(p,{className:"p-2",min:0,max:1,step:.01,value:[G],onValueChange:e=>{K(e[0])}})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{children:[(0,a.jsxs)("span",{className:"p-2 font-bold text-xs",children:["Erosion Iterations: ",Y]}),(0,a.jsx)(p,{className:"p-2",min:1,max:10,step:1,value:[Y],onValueChange:e=>{B(e[0])}})]})})]}),(0,a.jsxs)(N,{value:"colors",className:"flex-1 bg-slate-50 border rounded-md p-2",children:[(0,a.jsx)(E,{text:"Ambient Light",value:_,placeholder:f.KT,onChange:q}),(0,a.jsx)(E,{text:"Directional Light",value:T,placeholder:f.VB,onChange:H}),(0,a.jsx)(E,{text:"Water Color",value:O,placeholder:f.bp,onChange:Q}),(0,a.jsx)(S,{type:"single",collapsible:!0,className:"w-full",children:(0,a.jsxs)(z,{value:"item-1",children:[(0,a.jsxs)(k,{className:"flex",children:[(0,a.jsx)("div",{className:"w-1/2 text-start",children:"Gradient"}),(0,a.jsx)("div",{className:"w-1/2 border h-full rounded-md mr-2 ml-4",style:{background:"linear-gradient(180deg, ".concat(P[3],", ").concat(P[2],", ").concat(P[1],", ").concat(P[0],")")}})]}),(0,a.jsx)(D,{children:(0,a.jsx)(I,{currentGradient:P,onChange:e=>{W(e)}})})]})})]})]})]})}):(0,a.jsx)(a.Fragment,{})}},9923:function(e,t,l){l.d(t,{KB:function(){return f},R:function(){return c},aD:function(){return m},lY:function(){return p},pP:function(){return x},sv:function(){return i},y5:function(){return h},zl:function(){return d}});var a=l(1648),s=l(7020),n=l.n(s);let r=(e,t)=>{let l=[],a=t.canvasSize/2,s=t.canvasSize/2,n=e.dist(0,0,a,s)*t.maxDistanceFactor;for(let r=0;r<t.canvasSize;r++){l[r]=[];for(let o=0;o<t.canvasSize;o++){let i=e.noise(r*t.noiseScale,o*t.noiseScale)-e.dist(r,o,a,s)/n;i=e.constrain(i,0,1),l[r][o]=i,i>1e-4&&i<t.threshold&&(l[r][o]=0)}}return l},o=(e,t)=>{let l=e,a=e;for(let e=0;e<t.blurIterations;e++){a=l.map(e=>[...e]);for(let e=1;e<t.canvasSize-1;e++)for(let s=1;s<t.canvasSize-1;s++)a[e][s]=(3*l[e][s]+l[e-1][s]+l[e+1][s]+l[e][s-1]+l[e][s+1]+l[e-1][s-1]+l[e-1][s+1]+l[e+1][s-1]+l[e+1][s+1])/11;l=a}return a},i=(e,t,l,a)=>{let s=e.length;for(let t=0;t<s;t++)for(let n=0;n<s;n++)if(l[t][n]>0){let s=5e-4*a.erosionRate*l[t][n];e[t][n]=e[t][n]-s}return e},c=(e,t)=>{let l=t.canvasSize,a=Array(l).fill(null).map(()=>Array(l).fill(!1)),s=[{x:l-1,y:0}];for(;s.length>0;){let{x:t,y:n}=s.shift();if(!a[t][n]&&!(e[t][n]>.001))for(let e of(a[t][n]=!0,[{x:t-1,y:n},{x:t+1,y:n},{x:t,y:n-1},{x:t,y:n+1}]))e.x>=0&&e.x<l&&e.y>=0&&e.y<l&&s.push(e)}return a},u=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,d=(e,t)=>{let l=e.length,a=[];for(let s=0;s<l;s++)for(let n=0;n<l;n++)e[s][n]>t&&a.push({x:s,y:n});if(0===a.length)throw Error("No land tiles available to place the town square.");let s=u(0,a.length-1);return a[s]},f=(e,t,l,a,s)=>{let n=[];for(let s=-a;s<a;s++)for(let r=-a;r<a;r++)!(r*r+s*s>a*a)&&e[s+l.x][r+l.y]>t&&n.push({x:s+l.x,y:r+l.y});let r=()=>n[u(0,n.length-1)],o=[];for(let e=0;e<s;e+=1)o=o.concat(r());return o},x=(e,t,l,a)=>{let s=e.length,n=t,r=0;for(let o=-a;o<=a;o++)if(!(o>-l)||!(o<l))for(let i=-a;i<=a;i++){if(i>-l&&i<l)continue;let a=t.x+o,c=t.y+i;a>=0&&c>=0&&a<s&&c<s&&e[a][c]>r&&(r=e[a][c],n={x:a,y:c})}return n},h=e=>o(r(new(n())(e=>{}),e),e),m=(e,t)=>{let l=e.length,s=e[0].length,n=Array.from({length:l},()=>Array(s).fill(null));for(let r=0;r<l;r++)for(let o=0;o<s;o++){if(e[r][o]<t.threshold)continue;let i=-1/0,c=null;for(let n=0;n<a.nK.length;n++){let[u,d]=a.nK[n],f=r+u,x=o+d;if(f>=0&&f<l&&x>=0&&x<s){let l=e[f][x]<t.threshold?1:e[r][o]-e[f][x];l>i&&(i=l,c=n)}}if(null!==c){let[t,l]=a.nK[c];e[r+t][o+l],e[r][o],i<1e-6?n[r][o]=null:n[r][o]=c}e[r][o]>1e-4&&n[r][o]}return n},p=(e,t)=>{let l=e.length,s=e[0].length,n=Array.from({length:l},()=>Array(s).fill(0));for(let r=0;r<l;r++)for(let o=0;o<s;o++){if(null===e[r][o])continue;let i=r,c=o;for(;;){let r=e[i][c];if(null===r)break;let[o,u]=a.nK[r],d=i+o,f=c+u;if(d<0||d>=l||f<0||f>=s)break;t[d][f]>t[i][c]&&console.error("BIG ERROR"),n[d][f]+=1,i=d,c=f}}return n}}}]);