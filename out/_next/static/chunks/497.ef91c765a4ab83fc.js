"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{497:function(e,t,r){r.r(t),r.d(t,{default:function(){return O}});var i,n,o=r(7437),s=r(2265),a=r(7776),l=r(9733),h=r(9923),c=r(1648);let d=(e,t)=>{let r=new a.Pa4(0,0,-1),i=new a.iMs;return i.set(e,r),i.intersectObject(t)},m=(e,t,r)=>{let i=e.distanceTo(t),n=new a.fHI(.5,.5,i,32),o=new a.vBJ({color:r}),s=new a.Kj0(n,o),l=new a.Pa4().addVectors(e,t).multiplyScalar(.5);s.position.copy(l);let h=new a.Pa4().subVectors(t,e).normalize(),c=new a.Pa4(0,1,0).cross(h).normalize(),d=Math.acos(new a.Pa4(0,1,0).dot(h));return s.quaternion.setFromAxisAngle(c,d),s},u=(e,t)=>{let r=t.geometry,i=new a.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.heightmap.length-e.townSquare.y]*c.Vl),n=null;if(e.docks){let t=new a.Pa4(e.docks.x-r.parameters.width/2,e.heightmap.length-e.docks.y-r.parameters.height/2,e.heightmap[e.docks.x][e.heightmap.length-e.docks.y]*c.Vl),i=new a.Pa4(t.x,t.y,t.z+10);n=m(t,i,65535)}let o=null;if(e.temple){let t=new a.Pa4(e.temple.x-r.parameters.width/2,e.heightmap.length-e.temple.y-r.parameters.height/2,e.heightmap[e.temple.x][e.heightmap.length-e.temple.y]*c.Vl),i=new a.Pa4(t.x,t.y,t.z+10);o=m(t,i,16776960)}let s=new a.Pa4(i.x,i.y,i.z+10);return[m(i,s,16711935),n,o]},p=(e,t,r,i)=>{let n=r.geometry,o=new a.Pa4(e.x-n.parameters.width/2,t.length-e.y-n.parameters.height/2,t[e.x][e.y]*c.Vl),s=new a.Wid({color:16773358,roughness:.5,metalness:.1}),l=new a.fHI(15/i,13/i,2/i,32),h=new a.Kj0(l,s);h.position.set(o.x,o.y,o.z),h.rotation.x=-Math.PI/2;let d=new a.fHI(.5/i,.5/i,10/i,32),m=12/i,u=[];for(let e=0;e<12;e++){let t=e/12*2*Math.PI,r=m*Math.cos(t)+o.x,n=m*Math.sin(t)+o.y,l=new a.Kj0(d,s);l.position.set(r,n,o.z+5/i),l.rotation.x=-Math.PI/2,u=u.concat(l)}return[h,u]},w=(e,t)=>{let r=t.geometry,i=new a.Wid({color:16773358,roughness:.5,metalness:.1}),n=new a.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.townSquare.y]*c.Vl),o=new a.DvJ(1.2,1.2,.1),s=new a.Kj0(o,i);return s.position.set(n.x,n.y,n.z),s},v=(e,t,r)=>{let i=r.geometry,n=new a.Wid({color:16773358,roughness:.5,metalness:.1}),o=new a.Pa4(e.x-i.parameters.width/2,t.length-e.y-i.parameters.height/2,t[e.x][e.y]*c.Vl),s=new a.DvJ(1.2,1.2,.1),l=new a.Kj0(s,n);return l.position.set(o.x,o.y,o.z),l},g=(e,t,r)=>{r=Math.min(Math.max(r,0),1);let i=parseInt(e.substring(1),16),n=parseInt(t.substring(1),16),o=i>>16&255,s=i>>8&255,a=255&i,l=Math.round(o+r*((n>>16&255)-o)),h=Math.round(s+r*((n>>8&255)-s)),c=Math.round(a+r*((255&n)-a));return"#".concat((l<<16|h<<8|c).toString(16).padStart(6,"0"))},y=(e,t)=>{let r=e.heightmap.length,i=new a._12(r,r,r-1,r-1),n=[];for(let o=0;o<i.attributes.position.array.length;o+=3){let s;let l=Math.floor(o/3%r),h=Math.floor(o/3/r);i.attributes.position.setZ(o/3,10*e.heightmap[l][h]),s=new a.Ilk(e.heightmap[l][h]<.2?g(t.terrainGradient[0],t.terrainGradient[1],5*e.heightmap[l][h]):e.heightmap[l][h]<.3?g(t.terrainGradient[1],t.terrainGradient[2],e.heightmap[l][h]*(1/.3)):g(t.terrainGradient[2],t.terrainGradient[3],(e.heightmap[l][h]-.3)*(1/.7))),n.push(s.r,s.g,s.b)}i.setAttribute("color",new a.a$l(n,3)),i.computeVertexNormals();let o=new a.Wid({vertexColors:!0,roughness:.8,metalness:0,flatShading:!0});return new a.Kj0(i,o)},f=(e,t,r)=>{let i=new a._12(t,t,t-1,t-1),n=[];for(let t=0;t<i.attributes.position.array.length;t+=3){i.attributes.position.setZ(t/3,10*e);let o=new a.Ilk(r.waterColor);n.push(o.r,o.g,o.b)}i.setAttribute("color",new a.a$l(n,3)),i.computeVertexNormals();let o=new a.YBo({vertexColors:!0,flatShading:!0});return new a.Kj0(i,o)},b=(e,t)=>{let r=e.length,i=new a.Ilk(2237149),n=new a.ZAu,o=0;for(let t=0;t<r;t++)for(let i=0;i<r;i++)null!==e[t][i]&&e[t][i]>o&&(o=e[t][i]);for(let s=0;s<r;s++)for(let l=0;l<r;l++){if(null===e[s][l])continue;let h=e[s][l]/o;if(h<.05)continue;let c=new a.zf8(h,4),d=new a.vBJ({color:i}),m=new a.Kj0(c,d);m.position.set(s-r/2,r-l-r/2,10*t[s][l]+.5),n.add(m)}return n},x=e=>{let t=e.length,r=new a.ZAu;for(let i=0;i<t;i++)for(let n=0;n<t;n++){let o=e[i][n];if(null!==o){let e=c.nK[o],s=new a.Pa4(e[0],-e[1],0).normalize(),l=new a.tGC(s,new a.Pa4(i-t/2,t-n-t/2,12),1,11184895,.2,.2);r.add(l)}}return r},k=(e,t)=>{let r=new a.u9r,i=t.length,n=new Float32Array(3*e.length);e.forEach((e,r)=>{n[3*r]=e.x-i/2,n[3*r+1]=i-e.y-i/2,n[3*r+2]=10*t[e.x][e.y]+.2}),r.setAttribute("position",new a.TlE(n,3));let o=new a.nls({color:16777215,linewidth:2});return new a.x12(r,o)},S=(e,t)=>{let r=new a.ZAu,i=new a.fHI(.02+.05*t,.03+.05*t,1.5,6),n=new a.Wid({color:9127187}),o=new a.Kj0(i,n);o.position.set(e.x,e.y,e.z),o.rotation.x=-Math.PI/2,r.add(o);let s=new a.Wid({color:2263842}),l=[new a.b_z(.25+.25*t,.25+.2*t,5),new a.b_z(.2+.2*t,.25+.2*t,5),new a.b_z(.15+.15*t,.2+.15*t,5)],h=[.6+.4*t,.8+.4*t,1+.4*t];return l.forEach((t,i)=>{let n=new a.Kj0(t,s);n.rotation.x=Math.PI/2,n.position.set(e.x,e.y,e.z+h[i]),r.add(n)}),r},M=(e,t,r,i)=>{let n=t.length,o=[],s=0;for(let t=0;t<n;t++)for(let r=0;r<n;r++)null!==e[t][r]&&e[t][r]>s&&(s=e[t][r]);for(let l=0;l<n;l++)for(let h=0;h<n;h++){if(t[l][h]<r)continue;let n=Math.log(e[l][h]/s*(s-1)+1)/Math.log(s);if(n>.3){let e=Math.random()+l-t.length/2,s=Math.random()+(t.length-h)-t.length/2,c=d(new a.Pa4(e,s,9001),i);if(1!==c.length)continue;let m=c[0].point.z;if(m<10*r)continue;o=o.concat(S(new a.Pa4(e,s,m),n))}}return o},L=e=>{let t=new a.vBJ({color:c.JS,wireframe:!1}),r=new a.Kj0(new a.cJO(.2,0),t);r.position.set(e.x,e.y,e.z+.16000000000000003);let i=new a.vBJ({color:c.YS,wireframe:!1}),n=new a.Kj0(new a.cJO(.1,0),i);n.position.set(e.x+.2,e.y,e.z+.2);let o=(e,t,r,i,n)=>{let o=new a.fHI(e,t,r,i),s=new a.vBJ({color:n}),l=new a.Kj0(o,s);return l.rotation.x=Math.PI/2,l},s=o(.04000000000000001,.04000000000000001,.15000000000000002,5,c.YS),l=o(.04000000000000001,.04000000000000001,.15000000000000002,5,c.YS),h=o(.04000000000000001,.04000000000000001,.15000000000000002,5,c.YS),d=o(.04000000000000001,.04000000000000001,.15000000000000002,5,c.YS);s.position.set(e.x-.1,e.y-.06,e.z),l.position.set(e.x+.1,e.y-.06,e.z),h.position.set(e.x-.1,e.y+.06,e.z),d.position.set(e.x+.1,e.y+.06,e.z);let m=new a.ZAu;return[r,n,s,l,h,d].forEach(e=>m.add(e)),m},E=(e,t,r)=>{e.length;let i=[];for(let n=0;n<10;n+=1){let n=(0,h.zl)(e,t),o=(0,h.KB)(e,t,n,5,5);for(let n=0;n<o.length;n+=1){let s=o[n],l=Math.random()+s.x-e.length/2,h=Math.random()+(e.length-s.y)-e.length/2,c=d(new a.Pa4(l,h,9001),r);if(1!==c.length)continue;let m=c[0].point.z;m<10*t||(i=i.concat(L(new a.Pa4(l,h,m))))}}return i};var z=r(8938);let C=new a.USm(0,0,0,"ZYX"),P=new a.Pa4,F={type:"change"},D={type:"lock"},A={type:"unlock"};class j{connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}moveForward(e){this.isLocked&&(P.setFromMatrixColumn(this.camera.matrix,2),this.camera.position.addScaledVector(P,e))}moveRight(e){this.isLocked&&(P.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(P,e))}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}constructor(e,t=document.body){this.camera=e,this.domElement=t,this.isLocked=!1,this.pointerSpeed=1,this._onMouseMove=K.bind(this),this._onPointerlockChange=R.bind(this),this._onPointerlockError=I.bind(this),this.connect()}}function K(e){if(!this.isLocked)return;let t=e.movementX||e.mozMovementX||e.webkitMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||0;C.setFromQuaternion(this.camera.quaternion),C.z-=.002*t*this.pointerSpeed,C.x-=.002*r*this.pointerSpeed,this.camera.quaternion.setFromEuler(C),this.camera.dispatchEvent(F)}function R(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.isLocked=!0,this.camera.dispatchEvent(D)):(this.isLocked=!1,this.camera.dispatchEvent(A))}function I(){console.error("FPSControls: Unable to use Pointer Lock API")}(i=n||(n={}))[i.FreeFloat=0]="FreeFloat",i[i.Walking=1]="Walking",i[i.FlyHack=2]="FlyHack";let B={terrainMesh:null,waterMesh:null,flares:[],structures:[],roads:[],arrows:null,waterAccumulation:null,treesGroups:[],mobs:[]};class V{handleKeyDown(e){if(this.controls instanceof z.z){switch(e.key){case"w":let t=new a.Pa4(0,1,0);this.controls.target.addScaledVector(t,this.moveSpeed),this.camera.position.addScaledVector(t,this.moveSpeed);break;case"s":let r=new a.Pa4(0,-1,0);this.controls.target.addScaledVector(r,this.moveSpeed),this.camera.position.addScaledVector(r,this.moveSpeed);break;case"a":let i=new a.Pa4(-1,0,0);this.controls.target.addScaledVector(i,this.moveSpeed),this.camera.position.addScaledVector(i,this.moveSpeed);break;case"d":let n=new a.Pa4(1,0,0);this.controls.target.addScaledVector(n,this.moveSpeed),this.camera.position.addScaledVector(n,this.moveSpeed)}this.orbitControls.update()}else if(this.controls instanceof j)switch(e.key){case"w":this.input.moveForward=!0,this.input.moveBackward=!1;break;case"s":this.input.moveBackward=!0,this.input.moveForward=!1;break;case"a":this.input.moveLeft=!0,this.input.moveRight=!1;break;case"d":this.input.moveRight=!0,this.input.moveLeft=!1;break;case" ":this.input.canJump&&(this.velocity.z=2*this.moveSpeed,this.input.canJump=!1);default:this.input.moveForward=!1,this.input.moveBackward=!1,this.input.moveLeft=!1,this.input.moveRight=!1}}handleKeyUp(e){switch(e.key){case"w":this.input.moveForward=!1;break;case"s":this.input.moveBackward=!1;break;case"a":this.input.moveLeft=!1;break;case"d":this.input.moveRight=!1}}addMesh(e){this.scene.add(e)}removeMesh(e){this.scene.remove(e)}removeLayer(e){let t=this.layers[e];console.log("Removing layer ",e),Array.isArray(t)?t.forEach(e=>{e&&this.scene.remove(e)}):(console.log("removing object."),console.log(t),t&&this.scene.remove(t))}setLayer(e,t){if(!(e in this.layers)){console.error('Layer "'.concat(e,'" does not exist in layers'));return}if(this.removeLayer(e),typeof t!=typeof this.layers[e]){console.error("Bad layer assignment!");return}this.layers[e]=t}drawLayer(e){let t=this.layers[e];t&&(Array.isArray(t)?t.forEach(e=>{e&&this.scene.add(e)}):this.scene.add(t))}removeAllLayers(){this.layers=B}emptySceneBuffer(){for(;this.scene.children.length>0;)this.scene.remove(this.scene.children[0])}resetLights(){this.scene.add(this.lighting.ambientLight),this.scene.add(this.lighting.directionalLight)}returnToOverview(){this.cameraMode=n.FreeFloat,this.camera=N(this.camera),this.camera.updateProjectionMatrix(),this.orbitControls.reset(),this.orbitControls.enabled=!0,this.controls=this.orbitControls,this.fpsControls.unlock(),this.camera.position.set(0,0,100),this.orbitControls.target.copy(new a.Pa4(0,0,0)),this.fpsControls.domElement.removeEventListener("click",()=>{this.controls instanceof j&&this.fpsControls.lock()})}moveCameraAbovePosition(e){this.returnToOverview(),this.camera.position.set(e.x,e.y,50),this.orbitControls.target.copy(e),this.orbitControls.update()}turnGravityOn(){this.orbitControls.enabled=!1,this.controls=this.fpsControls,this.fpsControls.domElement.addEventListener("click",()=>{this.controls instanceof j&&this.fpsControls.lock()}),this.cameraMode=n.Walking}turnFlyHackOn(){this.orbitControls.enabled=!1,this.controls=this.fpsControls,this.fpsControls.domElement.addEventListener("click",()=>{this.controls instanceof j&&this.fpsControls.lock()}),this.cameraMode=n.FlyHack}advanceFrame(){let e=this.clock.getDelta();if(this.cameraMode===n.Walking){let t=[];this.layers.terrainMesh&&(t=d(new a.Pa4(this.camera.position.x,this.camera.position.y,999),this.layers.terrainMesh)),t.length>0&&(t[0].point.z>this.camera.position.z+this.velocity.z*e-.5?(this.camera.position.z=t[0].point.z+.5,this.velocity.z<1e-4?this.velocity.z=0:this.camera.position.z+=this.velocity.z*e,.01>Math.abs(this.velocity.x)?this.velocity.x=0:this.velocity.x-=10*this.velocity.x*e,.01>Math.abs(this.velocity.y)?this.velocity.y=0:this.velocity.y-=10*this.velocity.y*e,this.input.moveForward&&(this.velocity.y+=this.moveSpeed*e),this.input.moveBackward&&(this.velocity.y-=this.moveSpeed*e),this.input.moveLeft&&(this.velocity.x-=this.moveSpeed*e),this.input.moveRight&&(this.velocity.x+=this.moveSpeed*e),this.input.canJump=!0):(this.camera.position.z+=this.velocity.z*e,this.velocity.z-=this.gravity*e)),this.controls.moveRight(this.velocity.x*e),this.controls.moveForward(-1*this.velocity.y*e)}else this.cameraMode===n.FlyHack?(this.velocity.x-=10*this.velocity.x*e,this.velocity.y-=10*this.velocity.y*e,this.input.moveForward&&(this.velocity.y+=this.moveSpeed*e*30),this.input.moveBackward&&(this.velocity.y-=this.moveSpeed*e*30),this.input.moveLeft&&(this.velocity.x-=this.moveSpeed*e*30),this.input.moveRight&&(this.velocity.x+=this.moveSpeed*e*30),this.controls.moveRight(this.velocity.x*e),this.controls.moveForward(-1*this.velocity.y*e)):this.cameraMode===n.FreeFloat&&this.controls.update()}setDirectionalLight(e){this.lighting.directionalLight=new a.Ox3(e)}setAmbientLight(e){this.lighting.ambientLight=new a.Mig(e)}constructor(e,t){this.input={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,canJump:!1},this.velocity=new a.Pa4(0,0,0),this.gravity=9.81,this.moveSpeed=10,this.layers=B,this.clock=new a.SUY,this.cameraMode=n.FreeFloat,this.camera=new a.cPb,this.orbitControls=new z.z(this.camera,e.domElement),this.orbitControls.enableDamping=!0,this.orbitControls.dampingFactor=.05,this.fpsControls=new j(this.camera,e.domElement),this.fpsControls.domElement.ownerDocument.addEventListener("lock",()=>{}),this.fpsControls.domElement.ownerDocument.addEventListener("unlock",()=>{}),this.controls=this.orbitControls,this.lighting={ambientLight:new a.Mig(t.ambientLight),directionalLight:new a.Ox3(t.directionalLight)},this.lighting.directionalLight.position.set(50,50,50),this.scene=new a.xsS,this.scene.add(this.lighting.ambientLight),this.scene.add(this.lighting.directionalLight)}}let N=e=>(e.fov=c.d$,e.aspect=c.lK,e.near=c.CC,e.far=c.wt,e.position.set(0,0,100),e);class _{handleKeyDown(e){this.env.handleKeyDown(e)}handleKeyUp(e){this.env.handleKeyUp(e)}handleDisplayResize(e,t){this.env.camera.aspect=e/t,this.env.camera.updateProjectionMatrix()}resetScene(e){let t;for(t in this.env.emptySceneBuffer(),this.env.clock=new a.SUY,this.env.returnToOverview(),e)this.toggleLayer(t,e[t]);this.env.resetLights()}constructor(e,t,r){this.drawFunctions={terrainMesh:()=>y(this.world,this.colorsConfig),waterMesh:()=>f(this.world.waterLevel,this.world.heightmap.length,this.colorsConfig),structures:()=>{if(!this.env.layers.terrainMesh)return;let e=this.env.layers.terrainMesh,t=[];if(this.world.temple){let[r,i]=p(this.world.temple,this.world.heightmap,e,12);t=t.concat(r),i.forEach(e=>t=t.concat(e))}if(this.world.docks){let r=v(this.world.docks,this.world.heightmap,e);t=t.concat(r)}let r=w(this.world,e);return t=t.concat(r)},roads:()=>{let e=[];return this.world.templePath&&(e=e.concat(k(this.world.templePath,this.world.heightmap))),this.world.docksPath&&(e=e.concat(k(this.world.docksPath,this.world.heightmap))),e},flares:()=>{if(!this.env.layers.terrainMesh)return;let e=this.env.layers.terrainMesh;return u(this.world,e)},waterAccumulation:()=>b(this.world.waterAccumulation,this.world.heightmap),treesGroups:()=>{if(!this.env.layers.terrainMesh)return;let e=this.env.layers.terrainMesh;return M(this.world.waterAccumulation,this.world.heightmap,this.world.waterLevel,e)},arrows:()=>x(this.world.flowDirections),mobs:()=>{let e=this.env.layers.terrainMesh;return E(this.world.heightmap,this.world.waterLevel,e)}},this.toggleLayer=(e,t)=>{console.log(e);let r=this.layerConfig[e];if(console.log(r),t){let e=this.drawFunctions[r]();if(!e)return;this.env.setLayer(r,e),this.env.drawLayer(r)}else this.env.removeLayer(r)},this.world=t,this.colorsConfig=r,this.env=new V(e,this.colorsConfig),this.layerConfig={drawTerrain:"terrainMesh",drawWater:"waterMesh",drawStructures:"structures",drawRoads:"roads",showStructureFlares:"flares",showFlowDirections:"arrows",showWaterAccumulation:"waterAccumulation",showTrees:"treesGroups",showMobs:"mobs"}}}let q=(e,t,r)=>{(0,s.useEffect)(()=>{console.log("Display parameter ".concat(t," changed.")),r(t)},[e])};var O=e=>{let t;let r=(0,s.useRef)(null),i=(0,s.useRef)(null);document.getElementById("fullscreen-btn");let[n,h]=(0,s.useState)("Free Float"),[c,d]=(0,s.useState)(!1),m=(0,s.useRef)(null),u=(0,s.useRef)(null),p=()=>{var e,t,n,o;let s=null===(e=r.current)||void 0===e?void 0:e.clientWidth,a=null===(t=r.current)||void 0===t?void 0:t.clientHeight;null===(n=i.current)||void 0===n||n.setSize(s,a),null===(o=u.current)||void 0===o||o.handleDisplayResize(s,a)};for(t in(0,s.useEffect)(()=>{i.current||(i.current=new a.CP7({antialias:!0})),r.current.appendChild(i.current.domElement),p();let e=e=>{var t;null===(t=u.current)||void 0===t||t.handleKeyDown(e)},t=e=>{var t;null===(t=u.current)||void 0===t||t.handleKeyUp(e)};return window.addEventListener("resize",p),window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{var n;window.removeEventListener("keydown",e),window.removeEventListener("keyup",t),null===(n=r.current)||void 0===n||n.removeChild(i.current.domElement),i.current.dispose()}},[]),e.displayParams)q(e.displayParams[t],t,t=>{var r;null===(r=u.current)||void 0===r||r.toggleLayer(t,e.displayParams[t])});return(0,s.useEffect)(()=>{var t;null===(t=u.current)||void 0===t||t.env.setDirectionalLight(e.colorsConfig.directionalLight)},[e.colorsConfig.directionalLight]),(0,s.useEffect)(()=>{var t;null===(t=u.current)||void 0===t||t.env.setAmbientLight(e.colorsConfig.ambientLight)},[e.colorsConfig.ambientLight]),(0,s.useEffect)(()=>{let t;if(!r.current||!i.current||!e.world)return;u.current=new _(i.current,e.world,e.colorsConfig);let n=u.current;if(!n)return;n.resetScene(e.displayParams);let o=()=>{t=requestAnimationFrame(o),n.env.advanceFrame(),i.current.render(n.env.scene,n.env.camera)};return o(),()=>cancelAnimationFrame(t)},[e.world]),(0,o.jsx)("div",{ref:m,id:"three-container",tabIndex:0,className:"p-4 flex-1",children:(0,o.jsxs)("div",{className:"h-full justify-center",children:[(0,o.jsx)("div",{id:"fullscreen-button-container",className:"relative",children:(0,o.jsx)(l.z,{id:"fullscreen-btn",onClick:()=>{},className:"absolute top-1 right-2 z-10 p-4 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",children:"『』"})}),(0,o.jsx)("div",{id:"cameramode-label-container",className:"relative",children:(0,o.jsx)("div",{className:"flex p-4 absolute top-1 left-1 z-10",children:(0,o.jsxs)("span",{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",children:["Camera Mode: ",n]})})}),(0,o.jsx)("div",{ref:r,className:"h-full w-full bg-primary"}),(0,o.jsx)("div",{id:"buttons-container",className:"relative",children:(0,o.jsxs)("div",{className:"flex p-4 absolute bottom-1 left-1 z-10",children:[(0,o.jsx)(l.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{u.current&&(h("Free Float"),u.current.env.returnToOverview())},children:"\uD83D\uDDFA️"}),(0,o.jsx)(l.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{u.current&&(h("Free Float"),u.current.env.moveCameraAbovePosition(new a.Pa4(e.world.townSquare.x-u.current.env.layers.terrainMesh.geometry.parameters.width/2,e.world.heightmap.length-e.world.townSquare.y-u.current.env.layers.terrainMesh.geometry.parameters.height/2,10)))},children:"\uD83C\uDFD8️"}),(0,o.jsx)(l.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{u.current&&(h("Gravity On"),u.current.env.turnGravityOn())},children:"\uD83E\uDE82"}),(0,o.jsx)(l.z,{className:"px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",onClick:()=>{u.current&&(h("Fly-Hack"),u.current.env.turnFlyHackOn())},children:"\uD83D\uDEE9️"})]})})]})})}},9923:function(e,t,r){r.d(t,{KB:function(){return m},R:function(){return h},aD:function(){return w},lY:function(){return v},pP:function(){return u},sv:function(){return l},y5:function(){return p},zl:function(){return d}});var i=r(1648),n=r(7020),o=r.n(n);let s=(e,t)=>{let r=[],i=t.canvasSize/2,n=t.canvasSize/2,o=e.dist(0,0,i,n)*t.maxDistanceFactor;for(let s=0;s<t.canvasSize;s++){r[s]=[];for(let a=0;a<t.canvasSize;a++){let l=e.noise(s*t.noiseScale,a*t.noiseScale)-e.dist(s,a,i,n)/o;l=e.constrain(l,0,1),r[s][a]=l,l>1e-4&&l<t.threshold&&(r[s][a]=0)}}return r},a=(e,t)=>{let r=e,i=e;for(let e=0;e<t.blurIterations;e++){i=r.map(e=>[...e]);for(let e=1;e<t.canvasSize-1;e++)for(let n=1;n<t.canvasSize-1;n++)i[e][n]=(3*r[e][n]+r[e-1][n]+r[e+1][n]+r[e][n-1]+r[e][n+1]+r[e-1][n-1]+r[e-1][n+1]+r[e+1][n-1]+r[e+1][n+1])/11;r=i}return i},l=(e,t,r,i)=>{let n=e.length;for(let t=0;t<n;t++)for(let o=0;o<n;o++)if(r[t][o]>0){let n=5e-4*i.erosionRate*r[t][o];e[t][o]=e[t][o]-n}return e},h=(e,t)=>{let r=t.canvasSize,i=Array(r).fill(null).map(()=>Array(r).fill(!1)),n=[{x:r-1,y:0}];for(;n.length>0;){let{x:t,y:o}=n.shift();if(!i[t][o]&&!(e[t][o]>.001))for(let e of(i[t][o]=!0,[{x:t-1,y:o},{x:t+1,y:o},{x:t,y:o-1},{x:t,y:o+1}]))e.x>=0&&e.x<r&&e.y>=0&&e.y<r&&n.push(e)}return i},c=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,d=(e,t)=>{let r=e.length,i=[];for(let n=0;n<r;n++)for(let o=0;o<r;o++)e[n][o]>t&&i.push({x:n,y:o});if(0===i.length)throw Error("No land tiles available to place the town square.");let n=c(0,i.length-1);return i[n]},m=(e,t,r,i,n)=>{let o=[];for(let n=-i;n<i;n++)for(let s=-i;s<i;s++)!(s*s+n*n>i*i)&&e[n+r.x][s+r.y]>t&&o.push({x:n+r.x,y:s+r.y});let s=()=>o[c(0,o.length-1)],a=[];for(let e=0;e<n;e+=1)a=a.concat(s());return a},u=(e,t,r,i)=>{let n=e.length,o=t,s=0;for(let a=-i;a<=i;a++)if(!(a>-r)||!(a<r))for(let l=-i;l<=i;l++){if(l>-r&&l<r)continue;let i=t.x+a,h=t.y+l;i>=0&&h>=0&&i<n&&h<n&&e[i][h]>s&&(s=e[i][h],o={x:i,y:h})}return o},p=e=>a(s(new(o())(e=>{}),e),e),w=(e,t)=>{let r=e.length,n=e[0].length,o=Array.from({length:r},()=>Array(n).fill(null));for(let s=0;s<r;s++)for(let a=0;a<n;a++){if(e[s][a]<t.threshold)continue;let l=-1/0,h=null;for(let o=0;o<i.nK.length;o++){let[c,d]=i.nK[o],m=s+c,u=a+d;if(m>=0&&m<r&&u>=0&&u<n){let r=e[m][u]<t.threshold?1:e[s][a]-e[m][u];r>l&&(l=r,h=o)}}if(null!==h){let[t,r]=i.nK[h];e[s+t][a+r],e[s][a],l<1e-6?o[s][a]=null:o[s][a]=h}e[s][a]>1e-4&&o[s][a]}return o},v=(e,t)=>{let r=e.length,n=e[0].length,o=Array.from({length:r},()=>Array(n).fill(0));for(let s=0;s<r;s++)for(let a=0;a<n;a++){if(null===e[s][a])continue;let l=s,h=a;for(;;){let s=e[l][h];if(null===s)break;let[a,c]=i.nK[s],d=l+a,m=h+c;if(d<0||d>=r||m<0||m>=n)break;t[d][m]>t[l][h]&&console.error("BIG ERROR"),o[d][m]+=1,l=d,h=m}}return o}}}]);