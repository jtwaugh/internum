"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{8253:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var n,a,i=r(7437),o=r(2265),c=r(7776),l=r(8938),u=r(9733),s=r(1648);let d=(e,t,r)=>{let n=e.distanceTo(t),a=new c.fHI(.5,.5,n,32),i=new c.vBJ({color:r}),o=new c.Kj0(a,i),l=new c.Pa4().addVectors(e,t).multiplyScalar(.5);o.position.copy(l);let u=new c.Pa4().subVectors(t,e).normalize(),s=new c.Pa4(0,1,0).cross(u).normalize(),d=Math.acos(new c.Pa4(0,1,0).dot(u));return o.quaternion.setFromAxisAngle(s,d),o},h=(e,t)=>{let r=t.geometry,n=new c.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.heightmap.length-e.townSquare.y]*s.Vl),a=new c.Pa4(e.docks.x-r.parameters.width/2,e.heightmap.length-e.docks.y-r.parameters.height/2,e.heightmap[e.docks.x][e.heightmap.length-e.docks.y]*s.Vl),i=new c.Pa4(e.temple.x-r.parameters.width/2,e.heightmap.length-e.temple.y-r.parameters.height/2,e.heightmap[e.temple.x][e.heightmap.length-e.temple.y]*s.Vl),o=new c.Pa4(n.x,n.y,n.z+10),l=new c.Pa4(a.x,a.y,a.z+10),u=new c.Pa4(i.x,i.y,i.z+10);return[d(n,o,16711935),d(a,l,65535),d(i,u,16776960)]},g=(e,t,r)=>{let n=t.geometry,a=new c.Pa4(e.temple.x-n.parameters.width/2,e.heightmap.length-e.temple.y-n.parameters.height/2,e.heightmap[e.temple.x][e.temple.y]*s.Vl),i=new c.Wid({color:16773358,roughness:.5,metalness:.1}),o=new c.fHI(15/r,13/r,2/r,32),l=new c.Kj0(o,i);l.position.set(a.x,a.y,a.z),l.rotation.x=-Math.PI/2;let u=new c.fHI(.5/r,.5/r,10/r,32),d=12/r,h=[];for(let e=0;e<12;e++){let t=e/12*2*Math.PI,n=d*Math.cos(t)+a.x,o=d*Math.sin(t)+a.y,l=new c.Kj0(u,i);l.position.set(n,o,a.z+5/r),l.rotation.x=-Math.PI/2,h=h.concat(l)}return[l,h]},m=(e,t)=>{let r=t.geometry,n=new c.Wid({color:16773358,roughness:.5,metalness:.1}),a=new c.Pa4(e.townSquare.x-r.parameters.width/2,e.heightmap.length-e.townSquare.y-r.parameters.height/2,e.heightmap[e.townSquare.x][e.townSquare.y]*s.Vl),i=new c.DvJ(1.2,1.2,.1),o=new c.Kj0(i,n);return o.position.set(a.x,a.y,a.z),o},w=(e,t,r)=>{r=Math.min(Math.max(r,0),1);let n=parseInt(e.substring(1),16),a=parseInt(t.substring(1),16),i=n>>16&255,o=n>>8&255,c=255&n,l=Math.round(i+r*((a>>16&255)-i)),u=Math.round(o+r*((a>>8&255)-o)),s=Math.round(c+r*((255&a)-c));return"#".concat((l<<16|u<<8|s).toString(16).padStart(6,"0"))},p=(e,t)=>{console.log(t);let r=e.heightmap.length,n=new c._12(r,r,r-1,r-1),a=[];for(let i=0;i<n.attributes.position.array.length;i+=3){let o;let l=Math.floor(i/3%r),u=Math.floor(i/3/r);n.attributes.position.setZ(i/3,10*e.heightmap[l][u]),o=new c.Ilk(e.heightmap[l][u]<.001?t.terrainGradient[0]:e.heightmap[l][u]<.5?w(t.terrainGradient[1],t.terrainGradient[2],2*e.heightmap[l][u]):w(t.terrainGradient[2],t.terrainGradient[3],(e.heightmap[l][u]-.5)*2)),l===e.townSquare.x&&u===e.townSquare.y&&(o=new c.Ilk(16711935)),a.push(o.r,o.g,o.b)}n.setAttribute("color",new c.a$l(a,3)),n.computeVertexNormals();let i=new c.YBo({vertexColors:!0,flatShading:!0});return new c.Kj0(n,i)};(n=a||(a={}))[n.FreeFloat=0]="FreeFloat",n[n.FreeFall=1]="FreeFall",n[n.Walking=2]="Walking";var f=e=>{let t=(0,o.useRef)(null),r=(0,o.useRef)(null);document.getElementById("fullscreen-btn");let[n,a]=(0,o.useState)(!1),s=(0,o.useRef)(null),d=(0,o.useRef)(e.colorsConfig),w=(0,o.useRef)(null),f=(0,o.useRef)(null),x=(0,o.useRef)(null),b=(0,o.useRef)(null),y=(0,o.useRef)(null),v=(0,o.useRef)(null),S=(0,o.useRef)(null),j=(0,o.useRef)(null);(0,o.useRef)(null);let k=(0,o.useRef)(0),P=()=>{v.current.fov=75,v.current.aspect=1.5,v.current.near=.1,v.current.far=1e3,v.current.position.set(0,0,100)},z=(0,o.useRef)(0);return(0,o.useEffect)(()=>{d.current=e.colorsConfig,console.log(e.colorsConfig)},[e.colorsConfig]),(0,o.useEffect)(()=>{let e=new c.CP7({antialias:!0});e.setSize(Math.min(window.innerWidth,600),400),r.current=e,t.current.appendChild(r.current.domElement);let n=new c.xsS,a=new c.Mig(d.current.ambientLight);n.add(a),f.current=a;let i=new c.Ox3(d.current.directionalLight,100);i.position.set(50,50,50),n.add(i),x.current=i,w.current=n;let o=new c.cPb(75,1.5,.1,1e3);o.position.set(0,0,100),v.current=o;let u=new l.z(o,r.current.domElement);u.enableDamping=!0,u.dampingFactor=.05,j.current=u;let s=e=>{if(v.current&&S.current){if(S.current instanceof l.z)switch(e.key){case"w":let t=new c.Pa4(0,1,0);S.current.target.addScaledVector(t,10),v.current.position.addScaledVector(t,10);break;case"s":let r=new c.Pa4(0,-1,0);S.current.target.addScaledVector(r,10),v.current.position.addScaledVector(r,10);break;case"a":let n=new c.Pa4(-1,0,0);S.current.target.addScaledVector(n,10),v.current.position.addScaledVector(n,10);break;case"d":let a=new c.Pa4(1,0,0);S.current.target.addScaledVector(a,10),v.current.position.addScaledVector(a,10)}j.current.update()}};return S.current=u,k.current=0,()=>{var n;window.removeEventListener("keydown",s),null===(n=t.current)||void 0===n||n.removeChild(e.domElement),r.current.dispose()}},[]),(0,o.useEffect)(()=>{let e=new c.Mig(d.current.ambientLight);f.current=e},[e.colorsConfig.ambientLight]),(0,o.useEffect)(()=>{let e=new c.Ox3(d.current.directionalLight);x.current=e},[e.colorsConfig.directionalLight]),(0,o.useEffect)(()=>{let n;if(w.current)for(;w.current.children.length>0;)w.current.remove(w.current.children[0]);if(k.current=0,P(),j.current.enabled=!0,!t.current||!e.world||!r.current)return;if(b.current=new c.SUY,e.world.heightmap&&w.current){console.log(d.current);let t=p(e.world,d.current);y.current=t,w.current.add(t);{let[r,n,a]=h(e.world,t);w.current.add(r),w.current.add(n),w.current.add(a)}let[r,n]=g(e.world,t,12);w.current.add(r),n.forEach(e=>{w.current.add(e)});let a=m(e.world,t);w.current.add(a),f.current&&w.current.add(f.current),x.current&&w.current.add(x.current)}let a=()=>{n=requestAnimationFrame(a);let e=b.current.getDelta();if(1===k.current){z.current+=9.81*e,v.current.position.z-=z.current*e;let t=new c.Pa4(0,0,-1),r=new c.iMs;r.set(v.current.position,t);let n=r.intersectObject(y.current);n.length>0&&n[0].distance<=z.current*e&&(v.current.position.z=5,v.current.lookAt(new c.Pa4(1,0,0)),k.current=2,z.current=0)}else j.current.update();r.current.render(w.current,v.current)};return a(),()=>cancelAnimationFrame(n)},[e.world]),(0,i.jsx)("div",{ref:s,id:"three-container",tabIndex:0,className:"p-4",children:(0,i.jsx)("div",{className:"flex h-full justify-center",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{id:"fullscreen-button-container",className:"relative",children:(0,i.jsx)(u.z,{id:"fullscreen-btn",onClick:()=>{let t=!n;t?r.current.setSize(window.innerWidth-100,window.innerHeight-100):r.current.setSize(Math.min(window.innerWidth,600),400),a(t),e.handleFullscreenChange(t)},className:"absolute top-1 right-2 z-10 px-4 py-2 bg-black bg-opacity-50 text-white border-none cursor-pointer text-sm hover:bg-opacity-70",children:"『』"})}),(0,i.jsx)("div",{ref:t}),(0,i.jsx)("div",{id:"buttons-container",className:"relative",children:(0,i.jsxs)("div",{className:"flex p-4",children:[(0,i.jsx)("div",{className:"flex w-1/3",children:(0,i.jsx)(u.z,{onClick:()=>{v.current&&S.current&&(P(),k.current=0,v.current.updateProjectionMatrix(),j.current.reset(),j.current.enabled=!0,S.current=j.current)},children:"Reset View"})}),(0,i.jsx)("div",{className:"flex w-1/3 justify-center",children:(0,i.jsx)(u.z,{onClick:()=>{if(!v.current||!S.current||!e.world||!y.current)return;let t=new c.Pa4(e.world.townSquare.x-y.current.geometry.parameters.width/2,e.world.heightmap.length-e.world.townSquare.y-y.current.geometry.parameters.height/2,10);v.current.position.set(t.x,t.y,50),j.current.target.copy(t),j.current.update()},children:window.innerWidth>600?"Go to Town Center":"\uD83C\uDFD8️"})}),(0,i.jsx)("div",{className:"flex w-1/3 justify-end",children:(0,i.jsx)(u.z,{onClick:()=>{j.current.enabled=!1,k.current=1,console.log("Free fall")},children:"Free Fall"})})]})})]})})})}},9733:function(e,t,r){r.d(t,{z:function(){return u}});var n=r(7437),a=r(2265),i=r(1538),o=r(2218),c=r(9354);let l=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,t)=>{let{className:r,variant:a,size:o,asChild:u=!1,...s}=e,d=u?i.g7:"button";return(0,n.jsx)(d,{className:(0,c.cn)(l({variant:a,size:o,className:r})),ref:t,...s})});u.displayName="Button"},9354:function(e,t,r){r.d(t,{cn:function(){return i}});var n=r(4839),a=r(6164);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}}}]);